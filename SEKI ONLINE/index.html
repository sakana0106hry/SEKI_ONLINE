<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEKI Online</title>
    <link rel="stylesheet" href="styles/fonts.css">
    <link rel="stylesheet" href="styles/app/00-theme-base.css">
    <link rel="stylesheet" href="styles/app/10-effect-gambler.css">
    <link rel="stylesheet" href="styles/app/20-screen-login.css">
    <link rel="stylesheet" href="styles/app/30-layout-board.css">
    <link rel="stylesheet" href="styles/app/40-components-board-modal.css">
    <link rel="stylesheet" href="styles/app/50-effects-cutin.css">
    <link rel="stylesheet" href="styles/app/60-chat-mobile-public-info.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>

    <div id="login-screen">
        <canvas id="login-cyber-bg" aria-hidden="true"></canvas>
        <div class="login-grid" aria-hidden="true"></div>
        <div class="login-scanlines" aria-hidden="true"></div>

        <div id="login-panel">
            <img src="./images/new_logo.png" alt="SEKI Online" id="title-logo">
            <p class="version-text">Ver 30.00 NEW GAME</p>
            <p class="seki-tagline">STRATEGY // EFFICIENCY // KILLER // INTERFACE; S.E.K.I.</p>
            <input type="text" id="roomName" placeholder="Room ID (e.g. seki123)">
            <div id="room-suggestion-panel" class="hidden"></div>
            <input type="text" id="playerName" placeholder="Your Name">
            <button id="btn-join" onclick="joinGame()">JOIN / CREATE ROOM</button>
        </div>
    </div>

    <div id="asset-loading-screen" class="hidden" aria-live="polite" aria-busy="true">
        <div id="asset-loading-panel">
            <h3>
                LOADING S.E.K.I. PROTOCOL...
                <span class="seki-loading-sub">[STRATEGY-EFFICIENCY-KILLER-INTERFACE]</span>
            </h3>
            <p id="asset-loading-text">0 / 0 (0%)</p>
            <div id="asset-loading-progress-track">
                <div id="asset-loading-bar"></div>
            </div>
            <p id="asset-loading-current">準備中...</p>
            <div id="asset-loading-failed" class="hidden"></div>
            <div id="asset-loading-actions" class="hidden">
                <button id="asset-loading-retry-btn" type="button">再試行</button>
                <button id="asset-loading-continue-btn" type="button">続行</button>
            </div>
        </div>
    </div>

    <div id="boot-transition-screen" class="hidden" aria-hidden="true">
        <h2 id="boot-transition-title">S.E.K.I. BOOTING</h2>
    </div>

    <script src="scripts/bootstrap/login-cyber-bg.js"></script>

    <div id="game-screen" class="hidden">
        <div id="header-info" class="seki-topbar">
            <div id="room-display"></div>
            <div class="seki-topbar-actions">
                <button id="btn-host-settings" class="hidden seki-btn seki-btn-host seki-btn-accent" onclick="openHostSettings()">
                    ⚙️
                </button>
                <button onclick="showScoreboard()" class="seki-btn seki-btn-mini seki-btn-gold">🏆</button>
                <button onclick="showRoleList()" class="seki-btn seki-btn-mini seki-btn-accent">役職</button>
                <button onclick="showRule()" class="seki-btn seki-btn-mini">ルール</button>
                <button id="btn-bgm-toggle" onclick="toggleBgmMute()" class="seki-btn seki-btn-mini">🔊</button>
                <button onclick="leaveRoom()" class="seki-btn seki-btn-mini seki-btn-danger">🚪</button>
            </div>
        </div>

        <div id="game-table">
            
            <div id="area-top" class="player-zone row"></div>

            <div id="area-middle">
                <div id="area-left" class="player-zone col"></div>

                <div id="field-center">
                    <div id="flow-indicator-row">
                        <img id="indicator" src="./images/reverse_blue.jpg" alt="順行/逆行">
                        <div id="astronomer-indicator" aria-live="polite">
                            <div id="astronomer-indicator-state">観測待機</div>
                            <div id="astronomer-indicator-value">-</div>
                        </div>
                    </div>
                    
                    <div class="field-zone-container">
                        
                        <div class="field-zone zone-num">
                            <div class="zone-label">数字墓地</div>
                            
                            <div class="grave-slot" onclick="viewGrave('num')">
                                <div id="graveNum" class="pile"></div>
                            </div>
                            
                            <div class="deck-slot">
                                <div class="deck-icon num"></div>
                                <div id="deckNumCount" class="deck-count">-</div>
                            </div>
                        </div>

                        <div class="field-zone zone-sym">
                            <div class="zone-label">記号墓地</div>
                            
                            <div class="grave-slot" onclick="viewGrave('sym')">
                                <div id="graveSym" class="pile"></div>
                            </div>
                            
                            <div class="deck-slot">
                                <div class="deck-icon sym"></div>
                                <div id="deckSymCount" class="deck-count">-</div>
                            </div>
                        </div>
                    </div>

                    <div id="exclusion-area" onclick="viewGrave('excl')">
                        <span>🗑️除外：</span>
                        <span id="exclusion-count">0</span>
                    </div>
                    
                    <div id="msg" class="seki-msg">待機中...</div>

                    <div id="role-draft-monitor" class="hidden" aria-live="polite"></div>
                </div>

                <div id="area-right" class="player-zone col"></div>
            </div>

            <div id="my-area">
                <div id="my-name-bar" class="my-name-plate"></div>
            
                <div id="my-hand"></div>
                <div id="controls" class="seki-controls">
                    <button id="btn-play" onclick="playCard()" class="seki-btn seki-btn-accent">PLAY</button>
                    <button id="btn-pass" onclick="passTurn()" class="seki-btn seki-btn-soft">PASS</button>
                </div>

                <div id="my-role-panel"></div>

            </div>
        </div>
    </div>

    <div id="game-log-bar" onclick="showLogHistory()">ログを読み込み中...</div>

    <div id="modal-overlay" class="hidden">
        <div id="modal-box">
            <h3 id="modal-title">タイトル</h3>
            <div id="modal-content">内容</div>
            <div id="modal-footer">
                <button onclick="closeModal()" class="modal-btn ghost">CLOSE</button>
            </div>
        </div>
    </div>

    <div id="cut-in-overlay" class="hidden" aria-hidden="true">
        <svg aria-hidden="true" focusable="false">
            <defs>
                <filter id="cut-in-rgb-shift" x="-20%" y="-20%" width="140%" height="140%">
                    <feOffset in="SourceGraphic" dx="-5" dy="0" result="offR"></feOffset>
                    <feOffset in="SourceGraphic" dx="0" dy="0" result="offG"></feOffset>
                    <feOffset in="SourceGraphic" dx="5" dy="0" result="offB"></feOffset>
                    <feColorMatrix in="offR" type="matrix" values="1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0" result="chanR"></feColorMatrix>
                    <feColorMatrix in="offG" type="matrix" values="0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0" result="chanG"></feColorMatrix>
                    <feColorMatrix in="offB" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0" result="chanB"></feColorMatrix>
                    <feMerge>
                        <feMergeNode in="chanR"></feMergeNode>
                        <feMergeNode in="chanG"></feMergeNode>
                        <feMergeNode in="chanB"></feMergeNode>
                    </feMerge>
                </filter>
            </defs>
        </svg>
        <canvas id="cut-in-canvas" aria-hidden="true"></canvas>
        <div id="cut-in-scanlines" aria-hidden="true"></div>
        <div id="cut-in-metadata" aria-hidden="true">
            <div class="cut-in-meta-group cut-in-meta-top-left">
                <span>SYS_ID: 44X-99 ALPHA</span>
                <span>MEM: 2048TB [OK]</span>
                <span>SYNC: 99.9%</span>
                <span>PROT: ENCRYPTED_V4</span>
            </div>
            <div class="cut-in-meta-group cut-in-meta-top-right">
                <span>UPTIME: 4492:12:44</span>
                <span>CONN: SECURE</span>
                <span>MODE: BURST</span>
            </div>
            <div class="cut-in-meta-group cut-in-meta-bot-left">
                <span>SEC_SECTOR: 7G</span>
                <span>TRACE: NULL</span>
            </div>
            <div class="cut-in-meta-group cut-in-meta-bot-right">
                <span>LAT: 35.6895 LON: 139.6917</span>
                <span>PACKET_LOSS: 0.00%</span>
                <span>THREAT_LVL: MONITORING</span>
                <span>S.E.K.I. OS VER 2.0</span>
            </div>

            <div class="cut-in-meta-group cut-in-meta-log-scroll">
                <div class="cut-in-meta-log-content">> INITIATING HANDSHAKE...
> CONNECTING TO SERVER...
> AUTHENTICATING USER...
> LOADING ASSETS...
> [SUCCESS] STREAM OPEN
> BUFFERING DATA... 12%
> BUFFERING DATA... 45%
> BUFFERING DATA... 89%
> [WARNING] HIGH LATENCY
> OPTIMIZING ROUTE...
> ROUTE FOUND: NODE_04
> DECRYPTING KEY...
> ACCESS GRANTED.
> SYSTEM READY.
> EXECUTING SCRIPT...
> CHECKING INTEGRITY...
> THREAT DETECTED: NONE
> ALL SYSTEMS GO.
> WAITING FOR INPUT...</div>
            </div>
            <div class="cut-in-meta-group cut-in-meta-log-scroll-2">
                <div class="cut-in-meta-log-content-2">[INFO] Process 4491 started
[INFO] Memory alloc: 4096KB
[WARN] Deprecated API call
[INFO] Thread 2 suspended
[INFO] Garbage collection...
[INFO] GC finished in 4ms
[INFO] New socket open: 8080
[INFO] Token verified
[INFO] Session ID: x99a-22</div>
            </div>
            <div class="cut-in-meta-group cut-in-meta-hex">
                <div class="cut-in-meta-hex-content">0F 3A 9C 4D 55 1B 00 FF
A2 4E 88 90 11 22 33 44
55 66 77 88 99 AA BB CC
DD EE FF 00 12 34 56 78
9A BC DE F0 0F 3A 9C 4D
55 1B 00 FF A2 4E 88 90</div>
            </div>
            <div class="cut-in-meta-group cut-in-meta-system-scroll">
                <div class="cut-in-meta-system-content">CPU0: 12% [ACTIVE]
CPU1: 45% [ACTIVE]
CPU2: 09% [IDLE]
CPU3: 88% [BURST]
GPU0: 99% [RENDER]
VRAM: 8GB / 12GB
TEMP: 65C (NOMINAL)
FAN: 1200 RPM
POWER: STABLE
PING: 1ms</div>
            </div>
            <div class="cut-in-meta-stream cut-in-meta-stream-top">SCANNING_NETWORK // CHECKING_PORTS // FIREWALL_ACTIVE // USER_AUTH: OK // ENCRYPTION: AES-256 // CONNECTION: STABLE //</div>
            <div class="cut-in-meta-stream cut-in-meta-stream-bottom">DOWNLOADING_RESOURCES [||||||||||||||||----] 82% COMPLETE // VERIFYING CHECKSUM // INTEGRITY: 100% // NO MALWARE DETECTED //</div>
            <div class="cut-in-meta-bg-code">
                <div class="cut-in-meta-bg-code-content">function initSystem() {
  const core = new Core();
  core.loadModules(["net", "crypto", "fs"]);
  core.startService("daemon");
  if (core.status === "ok") {
    console.log("System Ready");
  } else {
    core.reboot();
  }
  return core.id;
}
class Core {
  constructor() {
    this.id = Math.random();
    this.status = "init";
  }
  loadModules(mods) {
    this.modules = mods;
  }
}</div>
            </div>
        </div>
        <div id="cut-in-fx" aria-hidden="true"></div>
        <div id="cut-in-slit">
            <div id="cut-in-role-image-wrap">
                <img src="" id="cut-in-role-img" alt="Role visual">
            </div>
            <div id="cut-in-info">
                <div id="cut-in-tags">
                    <div id="cut-in-role-name">ROLE NAME</div>
                    <div id="cut-in-player-name">PLAYER NAME</div>
                </div>
                <div id="cut-in-skill-names">
                    <div id="cut-in-skill-eng">COMMAND</div>
                    <div id="cut-in-skill-jp">スキル名</div>
                </div>
            </div>
        </div>
    </div>

    <div id="visual-overlay" class="seki-overlay" aria-hidden="true">
        <canvas id="gambler-cyber-canvas" aria-hidden="true"></canvas>
        <div id="gambler-cyber-scanlines" aria-hidden="true"></div>
        <div id="gambler-cyber-meta" aria-hidden="true">
            <div class="gambler-meta-stream top" id="gambler-meta-stream-top">:: GAMBLER PROTOCOL :: DATA ROUTING :: CARD ENCRYPTION ::</div>
            <div class="gambler-meta-stream bottom" id="gambler-meta-stream-bottom">:: SCAN MATRIX :: RESULT CHECKSUM :: SEKI ONLINE ::</div>
            <div class="gambler-meta-corner tl">
                <span id="gambler-meta-mode">MODE // STRATEGY</span>
                <span id="gambler-meta-proto">PROTO // GAMBLER-ACT</span>
            </div>
            <div class="gambler-meta-corner tr">
                <span id="gambler-meta-seed">SEED // 0x00000000</span>
                <span id="gambler-meta-state">STATE // IDLE</span>
            </div>
            <div class="gambler-meta-corner bl">
                <span id="gambler-meta-guess">GUESS // --</span>
                <span id="gambler-meta-card">CARD // --</span>
            </div>
            <div class="gambler-meta-corner br">
                <span id="gambler-meta-ts">SYNC // --</span>
            </div>
        </div>
        <div id="gambler-cyber-fx" aria-hidden="true"></div>
        <div id="gambler-cyber-panel">
            <div id="gambler-cyber-guess">GUESS MODE</div>
            <div id="gambler-cyber-card">
                <div id="gambler-cyber-value">?</div>
                <div id="gambler-cyber-mask">
                    <div class="logo">SEKI</div>
                </div>
            </div>
            <div id="gambler-cyber-result">RESULT</div>
        </div>
    </div>

    <script src="scripts/app/core/00-runtime-assets-audio.js"></script>
    <script src="scripts/app/core/01-firebase-constants-rolemeta.js"></script>
    <script src="scripts/app/core/02-state-cache-refs.js"></script>
    <script src="scripts/app/ui/32-viewport-hand-layout.js"></script>
    <script src="scripts/app/ui/33-loading-boot-ui.js"></script>
    <script src="scripts/app/ui/34-room-suggestion-ui.js"></script>
    <script src="scripts/app/ui/35-role-draft-ui.js"></script>
    <script src="scripts/app/core/03-modal-guard-log-chat.js"></script>
    <script src="scripts/app/core/04-room-lifecycle.js"></script>
    <script src="scripts/app/ui/40-game-screen-render.js"></script>
    <script src="scripts/app/ui/41-board-view-actions.js"></script>
    <script src="scripts/app/core/05-turn-actions-core.js"></script>
    <script src="scripts/app/roles/10-angler.js"></script>
    <script src="scripts/app/roles/11-fortune-teller.js"></script>
    <script src="scripts/app/roles/12-astronomer.js"></script>
    <script src="scripts/app/roles/13-politician.js"></script>
    <script src="scripts/app/roles/14-thief.js"></script>
    <script src="scripts/app/roles/15-hunter.js"></script>
    <script src="scripts/app/roles/16-gambler.js"></script>
    <script src="scripts/app/roles/17-crown.js"></script>
    <script src="scripts/app/roles/18-millionaire.js"></script>
    <script src="scripts/app/roles/19-emperor.js"></script>
    <script src="scripts/app/roles/20-police-officer.js"></script>
    <script src="scripts/app/roles/21-hacker.js"></script>
    <script src="scripts/app/roles/22-alchemist.js"></script>
    <script src="scripts/app/roles/23-necromancer.js"></script>
    <script src="scripts/app/roles/24-agent.js"></script>
    <script src="scripts/app/effects/30-cutin-effects.js"></script>
    <script src="scripts/app/ui/31-effect-listener-guides-score.js"></script>
    <script src="scripts/app/public/99-window-exports.js"></script>
    <div id="counter-hud-wrapper" class="hidden">
    <div id="counter-toggle-btn" onclick="toggleCounterHUD()">
        📊
    </div>

    <div id="counter-panel">
        <div class="hud-header">
            <span>CARD COUNTER</span>
            <span class="close-btn" onclick="toggleCounterHUD()">×</span>
        </div>
        
        <div class="hud-section-title">NUMBER (残/全4)</div>
        <div class="hud-grid" id="hud-grid-num">
            <div class="hud-loading">Loading...</div>
        </div>

        <div class="hud-section-title">SYMBOL</div>
        <div class="hud-grid-sym" id="hud-grid-sym">
            <div class="hud-loading">Loading...</div>
        </div>

        <div class="hud-section-title">ROLE CANDIDATES</div>
        <div class="hud-grid-role" id="hud-grid-role">
            <div class="hud-loading">No Data</div>
        </div>
        
        <div class="hud-footnote">
            ※山札 + 相手の手札にある数 ＆ 可能性がある役職を表示
        </div>
    </div>
</div>

    <link rel="stylesheet" href="styles/features/counter-hud.css">

<script src="scripts/features/counter-hud.js"></script>
<div id="sub-modal-overlay" class="hidden" onclick="closeSubModal()">
    <div id="sub-modal-box" onclick="event.stopPropagation()">
        <span class="close-btn" onclick="closeSubModal()">×</span>
        <h3 id="sub-modal-title">タイトル</h3>
        <div id="sub-modal-body"></div>
    </div>
</div>

    <link rel="stylesheet" href="styles/features/sub-modal.css">

<script src="scripts/features/modal-tools.js"></script>

</body>
</html>

