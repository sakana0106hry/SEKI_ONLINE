<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SEKI Online</title>
    <link rel="stylesheet" href="styles/fonts.css">
    <style>
    /* ベース設定：タイトル画面に寄せた全体テーマ */
    :root {
        --seki-s: #00d8ff;
        --seki-e: #34f78d;
        --seki-k: #ff355e;
        --seki-bg: #030a15;
        --seki-bg-deep: #02060e;
        --seki-bg-mid: #050d19;
        --seki-bg-bright: #0e2342;
        --seki-text-main: #eff6ff;
        --seki-text-sub: #d9ebff;
        --seki-text-muted: #9cb3c9;
        --seki-danger: #ef5350;
        --seki-warning: #ffeb3b;
        --seki-success: #34f78d;
        --seki-card-border: rgba(165, 205, 255, 0.35);
        --seki-panel-border: rgba(0, 216, 255, 0.32);
        --seki-panel-bg: rgba(4, 11, 23, 0.76);
        --seki-panel-bg-soft: rgba(6, 16, 32, 0.55);
        --seki-radius-sm: 8px;
        --seki-radius-md: 12px;
        --seki-radius-lg: 18px;
        --seki-shadow-soft: 0 8px 20px rgba(0, 0, 0, 0.36);
        --seki-shadow-panel: 0 18px 40px rgba(0, 0, 0, 0.52);
        --seki-shadow-glow: 0 0 26px rgba(0, 216, 255, 0.22);
        --seki-transition-fast: 0.2s ease;
        --seki-transition-mid: 0.3s ease;
    }

    html {
        min-height: 100%;
        background: var(--seki-bg-deep);
    }

    body {
        font-family: var(--font-ui);
        font-synthesis: none;
        font-synthesis-weight: none;
        background:
            radial-gradient(circle at 18% 14%, rgba(0, 216, 255, 0.14), transparent 36%),
            radial-gradient(circle at 82% 24%, rgba(255, 53, 94, 0.11), transparent 34%),
            radial-gradient(circle at 70% 78%, rgba(52, 247, 141, 0.08), transparent 36%),
            radial-gradient(circle at 50% 110%, #0e2342 0%, #050d19 48%, #02060e 100%);
        background-attachment: fixed;
        color: var(--seki-text-main);
        margin: 0;
        text-align: center;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        min-height: 100vh;
        min-height: 100dvh;
        min-height: var(--app-height, 100dvh);
        overflow-y: auto;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
    }

    /* 共通レイアウト */
    #game-screen {
        position: relative;
        isolation: isolate;
        padding: 0;
        margin: 0 auto;
        width: 100%;
        max-width: 860px;
        height: auto;
        min-height: 100vh;
        min-height: 100dvh;
        min-height: var(--app-height, 100dvh);
        display: flex;
        flex-direction: column;
        overflow: visible;
        background: linear-gradient(155deg, rgba(6, 16, 32, 0.5), rgba(2, 8, 18, 0.35));
        border-left: 1px solid rgba(0, 216, 255, 0.11);
        border-right: 1px solid rgba(0, 216, 255, 0.11);
        box-shadow: 0 0 40px rgba(0, 0, 0, 0.35);
    }
    #game-screen::before,
    #game-screen::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: -1;
    }
    #game-screen::before {
        background:
            linear-gradient(rgba(45, 100, 190, 0.11) 1px, transparent 1px),
            linear-gradient(90deg, rgba(45, 100, 190, 0.11) 1px, transparent 1px);
        background-size: 42px 42px;
        opacity: 0.45;
        animation: gameGridShift 22s linear infinite;
    }
    #game-screen::after {
        background: repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.026) 0px,
            rgba(255, 255, 255, 0.026) 1px,
            rgba(0, 0, 0, 0) 1px,
            rgba(0, 0, 0, 0) 4px
        );
        opacity: 0.24;
    }
    #header-info {
        flex: 0 0 42px;
        padding: 8px 10px;
    }
    .hidden { display: none !important; }
    .seki-topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 10px;
        font-size: 12px;
        height: 42px;
        border-bottom: 1px solid rgba(0, 216, 255, 0.22);
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.28), rgba(0, 0, 0, 0.12));
        backdrop-filter: blur(6px);
    }
    .seki-topbar-actions {
        display: flex;
        gap: 8px;
        align-items: center;
    }
    .seki-msg {
        margin-top: 2px;
        color: var(--seki-warning);
        font-weight: 400;
        font-size: 13px;
        letter-spacing: var(--font-ui-emphasis-tracking);
        height: 18px;
        line-height: 18px;
        white-space: nowrap;
        text-shadow: 0 0 8px rgba(255, 235, 59, 0.3);
    }
    .seki-controls {
        margin-top: 5px;
    }
    .seki-controls .seki-btn {
        min-width: 84px;
    }
    .seki-btn {
        border: 1px solid var(--seki-card-border);
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(4, 14, 30, 0.95), rgba(8, 22, 44, 0.92));
        color: var(--seki-text-main);
        font-family: var(--font-ui);
        font-size: 13px;
        letter-spacing: var(--font-ui-emphasis-tracking);
        text-shadow: var(--font-ui-emphasis-shadow);
        font-weight: 700;
        padding: 5px 12px;
        cursor: pointer;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.35);
        transition: transform var(--seki-transition-fast), box-shadow var(--seki-transition-fast), border-color var(--seki-transition-fast), filter var(--seki-transition-fast);
    }
    .seki-btn:hover:not(:disabled) {
        transform: translateY(-1px);
        border-color: rgba(0, 216, 255, 0.66);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.45), 0 0 14px rgba(0, 216, 255, 0.2);
    }
    .seki-btn:active:not(:disabled) {
        transform: translateY(1px);
    }
    .seki-btn:disabled,
    .seki-btn.is-disabled {
        background: rgba(84, 99, 118, 0.85);
        border-color: rgba(132, 147, 168, 0.7);
        color: rgba(239, 246, 255, 0.7);
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
        opacity: 0.78;
    }
    .seki-btn-mini {
        font-size: 12px;
        padding: 4px 9px;
    }
    .seki-btn-host {
        padding: 5px 12px;
        font-size: 15px;
        display: flex;
        align-items: center;
        border-radius: 18px;
    }
    .seki-btn-gold {
        background: linear-gradient(135deg, #bd8b14, #fbc02d 52%, #ffe082);
        color: #2f2214;
        border-color: rgba(255, 230, 156, 0.62);
    }
    .seki-btn-accent {
        background: linear-gradient(135deg, #0f314d, #166d98 46%, #00d8ff);
        color: #effbff;
        border-color: rgba(0, 216, 255, 0.65);
    }
    .seki-btn-danger {
        background: linear-gradient(135deg, #7c132a, #c21e44 46%, #ff355e);
        border-color: rgba(255, 143, 166, 0.75);
        color: #fff5f8;
    }
    .seki-btn-soft {
        background: linear-gradient(135deg, #2c3b54, #546e7a);
        border-color: rgba(197, 222, 255, 0.4);
    }
    .seki-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        pointer-events: none;
        color: var(--seki-text-main);
        background: rgba(1, 6, 14, 0.88);
        backdrop-filter: blur(4px);
    }
    #asset-loading-screen {
        position: fixed;
        inset: 0;
        z-index: 10050;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(2, 8, 18, 0.9);
        backdrop-filter: blur(5px);
        padding: 20px;
        box-sizing: border-box;
    }
    #asset-loading-screen.hidden {
        display: none !important;
    }
    #asset-loading-panel {
        width: min(92vw, 520px);
        border: 1px solid rgba(0, 216, 255, 0.4);
        border-radius: 14px;
        padding: 20px 18px;
        box-shadow: var(--seki-shadow-panel), 0 0 20px rgba(0, 216, 255, 0.22);
        background:
            linear-gradient(155deg, rgba(6, 16, 32, 0.95), rgba(4, 11, 23, 0.9)),
            radial-gradient(circle at 14% 16%, rgba(0, 216, 255, 0.13), transparent 42%);
    }
    #asset-loading-panel h3 {
        margin: 0 0 10px;
        font-size: 18px;
        color: #dff6ff;
        letter-spacing: 0.08em;
        text-shadow:
            0 0 6px rgba(0, 216, 255, 0.45),
            0 0 14px rgba(52, 247, 141, 0.28);
        line-height: 1.35;
        animation: sekiLoadingPulse 2.2s ease-in-out infinite alternate;
    }
    #asset-loading-panel h3 .seki-loading-sub {
        display: block;
        margin-top: 3px;
        font-size: 12px;
        color: #9ce8ff;
        letter-spacing: 0.14em;
    }
    @keyframes sekiLoadingPulse {
        from { filter: brightness(0.88); opacity: 0.9; }
        to { filter: brightness(1.08); opacity: 1; }
    }
    #asset-loading-text {
        margin: 0 0 8px;
        font-size: 14px;
        color: #cfe5f8;
        letter-spacing: var(--font-ui-emphasis-tracking);
    }
    #asset-loading-progress-track {
        width: 100%;
        height: 12px;
        border-radius: 999px;
        overflow: hidden;
        background: rgba(120, 145, 171, 0.35);
        border: 1px solid rgba(164, 194, 225, 0.38);
    }
    #asset-loading-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #00d8ff, #34f78d);
        transition: width 0.2s ease;
    }
    #asset-loading-current {
        margin: 9px 0 0;
        font-size: 12px;
        color: #9ec3df;
        min-height: 1.2em;
        word-break: break-all;
    }
    #asset-loading-failed {
        margin-top: 10px;
        font-size: 12px;
        text-align: left;
        border: 1px solid rgba(255, 152, 0, 0.35);
        background: rgba(45, 28, 6, 0.5);
        border-radius: 10px;
        padding: 8px 10px;
        color: #ffe3c0;
    }
    #asset-loading-failed ul {
        margin: 6px 0 0;
        padding-left: 18px;
    }
    #asset-loading-actions {
        margin-top: 12px;
        display: flex;
        justify-content: flex-end;
        gap: 8px;
    }
    #asset-loading-retry-btn,
    #asset-loading-continue-btn {
        border: 1px solid var(--seki-card-border);
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(4, 14, 30, 0.95), rgba(8, 22, 44, 0.92));
        color: var(--seki-text-main);
        font-family: var(--font-ui);
        font-size: 13px;
        letter-spacing: var(--font-ui-emphasis-tracking);
        text-shadow: var(--font-ui-emphasis-shadow);
        font-weight: 700;
        padding: 6px 12px;
        cursor: pointer;
    }
    #asset-loading-retry-btn:hover,
    #asset-loading-continue-btn:hover {
        border-color: rgba(0, 216, 255, 0.75);
    }
    #asset-loading-continue-btn {
        background: linear-gradient(135deg, #0f314d, #166d98 46%, #00d8ff);
    }
    #boot-transition-screen {
        position: fixed;
        inset: 0;
        z-index: 10070;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        transform-origin: left center;
        background:
            radial-gradient(circle at 18% 20%, rgba(0, 216, 255, 0.28), transparent 34%),
            radial-gradient(circle at 82% 28%, rgba(255, 53, 94, 0.18), transparent 36%),
            linear-gradient(145deg, #020814 0%, #051326 46%, #081e35 100%);
        will-change: opacity, transform, filter, clip-path;
    }
    #boot-transition-screen.hidden {
        display: none !important;
    }
    #boot-transition-screen::before {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.04) 0px,
            rgba(255, 255, 255, 0.04) 1px,
            rgba(0, 0, 0, 0) 1px,
            rgba(0, 0, 0, 0) 4px
        );
        opacity: 0.32;
    }
    #boot-transition-screen::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        opacity: 0.06;
        mix-blend-mode: screen;
        background:
            radial-gradient(circle at 17% 28%, rgba(0, 216, 255, 0.35), transparent 38%),
            radial-gradient(circle at 76% 62%, rgba(52, 247, 141, 0.24), transparent 34%),
            repeating-linear-gradient(
                95deg,
                rgba(255, 255, 255, 0.16) 0 2px,
                rgba(0, 0, 0, 0.08) 2px 5px,
                rgba(255, 53, 94, 0.16) 5px 7px,
                rgba(0, 0, 0, 0.06) 7px 11px
            );
        background-size: 100% 100%, 100% 100%, 240px 100%;
        background-position: center, center, 0 0;
        will-change: opacity, transform, background-position, filter, clip-path;
    }
    #boot-transition-screen.is-wiping {
        animation: sekiBootNoiseOut 900ms steps(14, end) forwards;
    }
    #boot-transition-screen.is-wiping::after {
        opacity: 0.72;
        animation: sekiBootNoiseFlicker 120ms steps(2, end) infinite;
    }
    #boot-transition-title {
        position: relative;
        z-index: 1;
        margin: 0;
        text-align: center;
        font-family: var(--font-ui);
        font-size: clamp(40px, 9vw, 98px);
        letter-spacing: 0.12em;
        color: #e9fbff;
        text-shadow:
            0 0 10px rgba(0, 216, 255, 0.55),
            0 0 26px rgba(52, 247, 141, 0.35),
            0 0 48px rgba(0, 216, 255, 0.18);
        padding: 0 18px;
    }
    #boot-transition-title.is-active {
        animation: sekiBootTitlePulse 0.55s ease-in-out infinite alternate;
    }
    #boot-transition-screen.is-wiping #boot-transition-title {
        text-shadow:
            0 0 9px rgba(0, 216, 255, 0.4),
            0 0 20px rgba(52, 247, 141, 0.28),
            0 0 36px rgba(255, 53, 94, 0.24);
    }
    @keyframes sekiBootNoiseOut {
        0% {
            opacity: 1;
            filter: contrast(1) saturate(1);
            clip-path: inset(0 0 0 0);
            transform: translate3d(0, 0, 0) scale(1);
        }
        20% {
            opacity: 0.94;
            clip-path: inset(0 0 0 0);
            transform: translate3d(3px, -1px, 0) scale(1.002);
        }
        40% {
            opacity: 0.84;
            clip-path: inset(3% 0 6% 0);
            transform: translate3d(-3px, 2px, 0) scale(1.003);
            filter: contrast(1.16) saturate(1.06);
        }
        58% {
            opacity: 0.6;
            clip-path: inset(11% 0 17% 0);
            transform: translate3d(4px, -3px, 0) scale(0.997);
            filter: contrast(1.26) saturate(1.12);
        }
        76% {
            opacity: 0.35;
            clip-path: inset(30% 0 40% 0);
            transform: translate3d(-4px, 3px, 0) scale(0.993);
            filter: contrast(1.32) saturate(1.2);
        }
        100% {
            opacity: 0;
            clip-path: inset(48% 0 52% 0);
            transform: translate3d(0, 0, 0) scale(0.985);
            filter: contrast(0.82) saturate(0.74);
        }
    }
    @keyframes sekiBootNoiseFlicker {
        0% {
            opacity: 0.28;
            transform: translate3d(0, 0, 0);
            background-position: center, center, 0 0;
        }
        25% {
            opacity: 0.54;
            transform: translate3d(-2px, 1px, 0);
            background-position: center, center, 55px 0;
        }
        50% {
            opacity: 0.4;
            transform: translate3d(2px, -2px, 0);
            background-position: center, center, -60px 0;
        }
        75% {
            opacity: 0.66;
            transform: translate3d(-3px, 2px, 0);
            background-position: center, center, 95px 0;
        }
        100% {
            opacity: 0.3;
            transform: translate3d(1px, -1px, 0);
            background-position: center, center, -40px 0;
        }
    }
    @keyframes sekiBootTitlePulse {
        from { filter: brightness(0.9); transform: scale(0.995); }
        to { filter: brightness(1.16); transform: scale(1.01); }
    }
    @keyframes sekiBootFadeOut {
        0% { opacity: 1; }
        100% { opacity: 0; }
    }
    /* --- 賭博師: サイバー演出 --- */
    #visual-overlay {
        --gambler-theme: var(--seki-s);
        --gambler-theme-rgb: 0, 216, 255;
        font-family: var(--font-ui);
        overflow: hidden;
    }
    #visual-overlay.guess-a {
        --gambler-theme: var(--seki-s);
        --gambler-theme-rgb: 0, 216, 255;
    }
    #visual-overlay.guess-b {
        --gambler-theme: var(--seki-e);
        --gambler-theme-rgb: 52, 247, 141;
    }
    #visual-overlay.guess-c {
        --gambler-theme: var(--seki-k);
        --gambler-theme-rgb: 255, 53, 94;
    }
    #gambler-cyber-canvas,
    #gambler-cyber-scanlines,
    #gambler-cyber-meta,
    #gambler-cyber-fx {
        position: absolute;
        inset: 0;
        pointer-events: none;
    }
    #gambler-cyber-canvas {
        z-index: 0;
    }
    #gambler-cyber-scanlines {
        z-index: 2;
        opacity: 0.48;
        background: repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.06) 0px,
            rgba(255, 255, 255, 0.06) 1px,
            rgba(0, 0, 0, 0) 1px,
            rgba(0, 0, 0, 0) 4px
        );
    }
    #gambler-cyber-meta {
        z-index: 3;
        color: rgba(var(--gambler-theme-rgb), 0.84);
        font-family: var(--font-readable);
        font-size: 11px;
        letter-spacing: 0.04em;
        mix-blend-mode: screen;
    }
    .gambler-meta-corner {
        position: absolute;
        display: flex;
        flex-direction: column;
        gap: 2px;
    }
    .gambler-meta-corner.tl {
        top: 20px;
        left: 20px;
    }
    .gambler-meta-corner.tr {
        top: 20px;
        right: 20px;
        text-align: right;
    }
    .gambler-meta-corner.bl {
        bottom: 20px;
        left: 20px;
    }
    .gambler-meta-corner.br {
        bottom: 20px;
        right: 20px;
        text-align: right;
    }
    .gambler-meta-stream {
        position: absolute;
        left: 0;
        right: 0;
        white-space: nowrap;
        opacity: 0.42;
        overflow: hidden;
    }
    .gambler-meta-stream.top {
        top: 6px;
        animation: gamblerMetaDriftRight 26s linear infinite;
    }
    .gambler-meta-stream.bottom {
        bottom: 6px;
        animation: gamblerMetaDriftLeft 26s linear infinite;
    }
    @keyframes gamblerMetaDriftRight {
        0% { transform: translateX(-24%); }
        100% { transform: translateX(0%); }
    }
    @keyframes gamblerMetaDriftLeft {
        0% { transform: translateX(0%); }
        100% { transform: translateX(-24%); }
    }
    #gambler-cyber-fx {
        z-index: 4;
        opacity: 0.7;
        background:
            radial-gradient(circle at 50% 40%, rgba(var(--gambler-theme-rgb), 0.16), transparent 62%),
            linear-gradient(120deg, rgba(var(--gambler-theme-rgb), 0.1), transparent 58%);
    }
    #gambler-cyber-fx::before {
        content: "";
        position: absolute;
        inset: 0;
        background:
            linear-gradient(rgba(var(--gambler-theme-rgb), 0.18) 1px, transparent 1px),
            linear-gradient(90deg, rgba(var(--gambler-theme-rgb), 0.18) 1px, transparent 1px);
        background-size: 44px 44px;
        opacity: 0.32;
        animation: gamblerGridShift 8s linear infinite;
    }
    #gambler-cyber-fx::after {
        content: "";
        position: absolute;
        inset: -20%;
        border: 2px dashed rgba(var(--gambler-theme-rgb), 0.36);
        border-radius: 50%;
        filter: blur(0.2px);
        animation: gamblerRingSpin 14s linear infinite;
    }
    @keyframes gamblerGridShift {
        0% { transform: translate3d(0, 0, 0); }
        100% { transform: translate3d(44px, 44px, 0); }
    }
    @keyframes gamblerRingSpin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    #gambler-cyber-panel {
        position: relative;
        z-index: 10;
        width: min(840px, 94vw);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        padding: 26px 20px;
    }
    #gambler-cyber-guess {
        padding: 8px 16px;
        border: 1px solid rgba(var(--gambler-theme-rgb), 0.62);
        border-radius: 999px;
        font-family: var(--font-display-strong);
        font-size: clamp(20px, 3vw, 32px);
        font-weight: 900;
        color: #eaf7ff;
        letter-spacing: 0.09em;
        text-shadow: 0 0 20px rgba(var(--gambler-theme-rgb), 0.52);
        background: linear-gradient(135deg, rgba(6, 16, 32, 0.92), rgba(4, 11, 23, 0.82));
        box-shadow: 0 0 16px rgba(var(--gambler-theme-rgb), 0.24), inset 0 0 20px rgba(var(--gambler-theme-rgb), 0.16);
    }
    #gambler-cyber-card {
        position: relative;
        width: min(300px, 64vw);
        aspect-ratio: 2 / 3;
        border-radius: 16px;
        border: 1px solid rgba(var(--gambler-theme-rgb), 0.66);
        overflow: hidden;
        background: linear-gradient(165deg, rgba(8, 18, 36, 0.95), rgba(4, 10, 22, 0.98));
        box-shadow: 0 18px 34px rgba(0, 0, 0, 0.6), 0 0 24px rgba(var(--gambler-theme-rgb), 0.3);
    }
    #gambler-cyber-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(140deg, rgba(var(--gambler-theme-rgb), 0.12), transparent 55%);
        pointer-events: none;
    }
    #gambler-cyber-value {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--font-display-strong);
        font-size: clamp(110px, 20vw, 190px);
        font-weight: 900;
        color: #eaf7ff;
        letter-spacing: 0.06em;
        opacity: 0.08;
        transform: scale(0.92);
        text-shadow: 0 0 26px rgba(var(--gambler-theme-rgb), 0.56);
        transition: transform 360ms ease, opacity 360ms ease;
    }
    #gambler-cyber-card.is-revealed #gambler-cyber-value {
        opacity: 1;
        transform: scale(1);
    }
    #gambler-cyber-mask {
        position: absolute;
        inset: 0;
        z-index: 2;
        transform: translateY(0%);
        transition: transform 2200ms cubic-bezier(0.22, 1, 0.36, 1);
        background:
            linear-gradient(160deg, rgba(10, 30, 54, 0.96), rgba(8, 16, 30, 0.95)),
            repeating-linear-gradient(45deg, rgba(var(--gambler-theme-rgb), 0.24), rgba(var(--gambler-theme-rgb), 0.24) 9px, rgba(0, 0, 0, 0.2) 9px, rgba(0, 0, 0, 0.2) 18px);
    }
    #gambler-cyber-mask .logo {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: var(--font-display-strong);
        font-size: clamp(44px, 9vw, 70px);
        letter-spacing: 0.2em;
        color: rgba(var(--gambler-theme-rgb), 0.3);
        text-shadow: 0 0 16px rgba(var(--gambler-theme-rgb), 0.32);
    }
    #gambler-cyber-card.is-scanning #gambler-cyber-mask::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        height: 3px;
        top: 0;
        background: rgba(var(--gambler-theme-rgb), 0.9);
        box-shadow: 0 0 10px rgba(var(--gambler-theme-rgb), 0.9);
        animation: gamblerScanline 1.1s linear infinite;
    }
    @keyframes gamblerScanline {
        0% { top: -6%; }
        100% { top: 106%; }
    }
    #gambler-cyber-result {
        min-height: 72px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px 30px;
        border-radius: 999px;
        border: 2px solid rgba(var(--gambler-theme-rgb), 0.7);
        font-family: var(--font-display-strong);
        font-size: clamp(34px, 8vw, 62px);
        font-weight: 900;
        color: #eff6ff;
        letter-spacing: 0.12em;
        opacity: 0;
        transform: translateY(10px) scale(0.88);
        text-shadow: 0 0 18px rgba(var(--gambler-theme-rgb), 0.5), 0 0 4px rgba(0, 0, 0, 0.9);
        background: rgba(4, 10, 22, 0.84);
        box-shadow: 0 0 24px rgba(var(--gambler-theme-rgb), 0.24), inset 0 0 18px rgba(var(--gambler-theme-rgb), 0.2);
        transition: transform 260ms ease, opacity 260ms ease;
    }
    #gambler-cyber-result.is-show {
        opacity: 1;
        transform: translateY(0) scale(1);
        animation: gamblerResultGlitch 420ms steps(4, end) 1;
    }
    @keyframes gamblerResultGlitch {
        0% { clip-path: inset(0 0 0 0); transform: translateY(0) scale(1); }
        25% { clip-path: inset(8% 0 14% 0); transform: translate(-3px, 1px) scale(1.03); }
        50% { clip-path: inset(28% 0 33% 0); transform: translate(4px, -2px) scale(0.99); }
        75% { clip-path: inset(18% 0 21% 0); transform: translate(-2px, 2px) scale(1.02); }
        100% { clip-path: inset(0 0 0 0); transform: translateY(0) scale(1); }
    }
    @media (max-width: 680px) {
        #gambler-cyber-panel {
            padding: 18px 12px;
            gap: 14px;
        }
        #gambler-cyber-guess {
            font-size: clamp(16px, 4.8vw, 22px);
            letter-spacing: 0.06em;
        }
        .gambler-meta-corner {
            font-size: 9px;
            opacity: 0.75;
        }
    }
    
    /* --- S.E.K.I. タイトル画面（ログイン専用） --- */
    #login-screen {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        padding: 20px;
        padding-top: max(20px, env(safe-area-inset-top));
        padding-right: max(20px, env(safe-area-inset-right));
        padding-bottom: max(20px, env(safe-area-inset-bottom));
        padding-left: max(20px, env(safe-area-inset-left));
        overflow: hidden;
        isolation: isolate;
        box-sizing: border-box;
        background: radial-gradient(circle at 50% 100%, #0e2342 0%, #050d19 48%, #02060e 100%);
    }

    #login-cyber-bg,
    .login-grid,
    .login-scanlines {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }
    #login-cyber-bg { z-index: 0; }

    .login-grid {
        z-index: 1;
        background:
            radial-gradient(circle at 18% 16%, rgba(0, 216, 255, 0.22), transparent 44%),
            radial-gradient(circle at 82% 26%, rgba(255, 53, 94, 0.14), transparent 36%),
            radial-gradient(circle at 74% 84%, rgba(52, 247, 141, 0.16), transparent 40%),
            linear-gradient(rgba(45, 100, 190, 0.18) 1px, transparent 1px),
            linear-gradient(90deg, rgba(45, 100, 190, 0.18) 1px, transparent 1px);
        background-size: auto, auto, auto, 48px 48px, 48px 48px;
        animation: loginGridShift 16s linear infinite;
    }

    .login-scanlines {
        z-index: 2;
        background: repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.05) 0px,
            rgba(255, 255, 255, 0.05) 1px,
            rgba(0, 0, 0, 0) 1px,
            rgba(0, 0, 0, 0) 4px
        );
        opacity: 0.3;
        animation: loginScanlineShift 10s linear infinite;
    }

    #login-panel {
        position: relative;
        z-index: 3;
        width: min(520px, 100%);
        max-width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        padding: 34px 30px 30px;
        box-sizing: border-box;
        border-radius: 20px;
        border: 1px solid rgba(0, 216, 255, 0.42);
        background:
            linear-gradient(155deg, rgba(6, 16, 32, 0.85), rgba(4, 11, 23, 0.72)),
            radial-gradient(circle at 14% 18%, rgba(0, 216, 255, 0.12), transparent 38%);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        box-shadow:
            0 24px 54px rgba(0, 0, 0, 0.62),
            0 0 40px rgba(0, 216, 255, 0.16),
            inset 0 0 25px rgba(0, 216, 255, 0.08);
        animation: loginPanelPulse 6s ease-in-out infinite alternate;
    }

    #title-logo {
        width: 100%;
        max-width: 450px;
        height: auto;
        object-fit: contain;
        filter:
            drop-shadow(0 0 14px rgba(0, 216, 255, 0.38))
            drop-shadow(0 0 26px rgba(255, 53, 94, 0.2));
        animation: loginLogoFloat 3.8s ease-in-out infinite alternate;
        margin-bottom: 2px;
    }

    .version-text {
        margin: 0;
        font-family: var(--font-ui);
        font-size: 12px;
        letter-spacing: 1.5px;
        color: #cfe8ff;
        text-shadow: 0 0 10px rgba(0, 216, 255, 0.36);
        opacity: 0.92;
    }

    .seki-tagline {
        margin: 12px 0;
        font-size: 12px;
        color: #d9ebff;
        letter-spacing: 0.8px;
        text-shadow: 0 0 8px rgba(0, 216, 255, 0.22);
    }

    #login-screen input {
        width: 100%;
        border: 1px solid rgba(165, 205, 255, 0.3);
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.3);
        color: #eff6ff;
        padding: 13px 14px;
        font-size: 15px;
        font-family: var(--font-ui);
        letter-spacing: 1px;
        text-align: center;
        appearance: none;
        -webkit-appearance: none;
        transition: border-color 0.25s ease, box-shadow 0.25s ease, transform 0.2s ease;
    }
    #login-screen input::placeholder { color: rgba(216, 235, 255, 0.56); }
    #login-screen input:focus {
        outline: none;
        transform: translateY(-1px);
    }
    #roomName:focus {
        border-color: var(--seki-s);
        box-shadow: 0 0 0 2px rgba(0, 216, 255, 0.2), 0 0 18px rgba(0, 216, 255, 0.36);
    }
    #playerName:focus {
        border-color: var(--seki-e);
        box-shadow: 0 0 0 2px rgba(52, 247, 141, 0.18), 0 0 18px rgba(52, 247, 141, 0.35);
    }

    #login-screen input:-webkit-autofill,
    #login-screen input:-webkit-autofill:hover,
    #login-screen input:-webkit-autofill:focus {
        -webkit-text-fill-color: #eff6ff;
        -webkit-box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.3) inset;
        box-shadow: 0 0 0 1000px rgba(0, 0, 0, 0.3) inset;
        caret-color: #eff6ff;
        transition: background-color 9999s ease-out 0s;
    }

    #room-suggestion-panel {
        width: 100%;
        max-height: 170px;
        overflow-y: auto;
        margin-top: -2px;
        margin-bottom: 2px;
        font-family: var(--font-ui);
        border-radius: 12px;
        border: 1px solid rgba(0, 216, 255, 0.33);
        background: rgba(2, 10, 20, 0.92);
        box-shadow: inset 0 0 14px rgba(0, 216, 255, 0.1), 0 8px 20px rgba(0, 0, 0, 0.36);
    }
    .room-suggestion-title {
        font-family: var(--font-ui);
        font-size: 11px;
        letter-spacing: 0.5px;
        color: #a5cfff;
        padding: 8px 10px 5px;
        text-align: left;
    }
    .room-suggestion-item {
        width: 100%;
        border: none;
        background: transparent;
        color: #e8f4ff;
        text-align: left;
        padding: 9px 10px;
        font-family: var(--font-ui);
        font-size: 13px;
        cursor: pointer;
        transition: background 0.18s ease;
    }
    .room-suggestion-item:hover {
        background: rgba(0, 216, 255, 0.12);
    }
    .room-suggestion-empty {
        padding: 10px;
        font-family: var(--font-ui);
        font-size: 12px;
        text-align: left;
        color: #9cb3c9;
    }

    #login-screen #btn-join {
        width: 100%;
        margin-top: 8px;
        padding: 14px 18px;
        border: 1px solid rgba(255, 143, 166, 0.72);
        border-radius: 12px;
        background: linear-gradient(135deg, #8f0f2d 0%, #d81f48 42%, #ff355e 100%);
        color: #fff5f8;
        font-family: var(--font-ui);
        font-size: 16px;
        font-weight: 800;
        letter-spacing: 1px;
        cursor: pointer;
        text-transform: uppercase;
        clip-path: polygon(4% 0%, 100% 0%, 100% 84%, 96% 100%, 0% 100%, 0% 16%);
        box-shadow: 0 10px 24px rgba(255, 53, 94, 0.32), 0 0 20px rgba(255, 53, 94, 0.28);
        transition: transform 0.22s ease, box-shadow 0.22s ease, filter 0.22s ease;
    }
    #login-screen #btn-join:hover {
        transform: translateY(-1px) scale(1.01);
        filter: saturate(1.15);
        box-shadow: 0 14px 34px rgba(255, 53, 94, 0.42), 0 0 26px rgba(255, 53, 94, 0.46);
    }
    #login-screen #btn-join:active { transform: translateY(1px); }
    #login-screen #btn-join:disabled {
        background: #4d5563;
        border-color: #6c7482;
        clip-path: none;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }

    @keyframes loginPanelPulse {
        0% { box-shadow: 0 24px 54px rgba(0, 0, 0, 0.62), 0 0 34px rgba(0, 216, 255, 0.14), inset 0 0 20px rgba(0, 216, 255, 0.08); }
        100% { box-shadow: 0 24px 54px rgba(0, 0, 0, 0.7), 0 0 46px rgba(0, 216, 255, 0.25), inset 0 0 25px rgba(52, 247, 141, 0.08); }
    }
    @keyframes loginLogoFloat {
        0% { transform: translateY(0px); }
        100% { transform: translateY(-6px); }
    }
    @keyframes loginGridShift {
        0% { transform: translate3d(0, 0, 0); }
        100% { transform: translate3d(-20px, -24px, 0); }
    }
    @keyframes loginScanlineShift {
        0% { transform: translateY(0); }
        100% { transform: translateY(4px); }
    }
    @keyframes gameGridShift {
        0% { transform: translate3d(0, 0, 0); }
        100% { transform: translate3d(-18px, -16px, 0); }
    }

    @media (max-width: 600px) {
        body { background-attachment: scroll; }
        #login-screen {
            padding: 12px;
            padding-top: max(12px, env(safe-area-inset-top));
            padding-right: max(12px, env(safe-area-inset-right));
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            padding-left: max(12px, env(safe-area-inset-left));
        }
        #login-panel {
            width: min(440px, 100%);
            padding: 24px 18px 22px;
            gap: 8px;
            border-radius: 16px;
        }
        #title-logo { max-width: 340px; }
        .seki-tagline { margin: 10px 0; font-size: 11px; }
        #login-screen input { padding: 11px 12px; font-size: 14px; }
        #login-screen #btn-join { font-size: 14px; padding: 12px 14px; }
    }

    @media (prefers-reduced-motion: reduce) {
        .login-grid,
        .login-scanlines,
        #login-panel,
        #title-logo,
        #game-screen::before {
            animation: none !important;
        }
        #login-screen input,
        #login-screen #btn-join,
        .seki-btn {
            transition: none !important;
        }
        #boot-transition-title.is-active {
            animation: none !important;
        }
        #boot-transition-screen.is-wiping {
            animation: sekiBootFadeOut 300ms ease forwards !important;
            transform: none !important;
            clip-path: inset(0 0 0 0) !important;
            filter: none !important;
        }
        #boot-transition-screen.is-wiping::after {
            animation: none !important;
            opacity: 0 !important;
        }
        .role-draft-card.fade-out,
        .role-draft-card.fade-out .role-draft-card-inner,
        .role-draft-card.fade-out .role-draft-card-media img,
        .role-draft-card.fade-out::before,
        .role-draft-card.fade-out::after {
            animation: none !important;
            transform: none !important;
            filter: none !important;
        }
        .role-draft-card.fade-out {
            opacity: 0.15 !important;
        }
        .role-draft-card.fade-out::after {
            content: none !important;
            opacity: 0 !important;
        }
        .role-draft-card.fade-out::before {
            content: none !important;
            opacity: 0 !important;
        }
    }

    /* エリアごとのパネル化（グラスモーフィズム） */
    #my-area {
        background: linear-gradient(155deg, rgba(6, 16, 32, 0.82), rgba(4, 11, 23, 0.74));
        backdrop-filter: blur(7px);
        border-radius: var(--seki-radius-lg);
        border: 1px solid var(--seki-panel-border);
        padding: 15px;
        box-shadow: var(--seki-shadow-panel), inset 0 0 18px rgba(0, 216, 255, 0.08);
        margin-top: 10px;
    }
    #my-hand {
        width: 100%;
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: flex-end;
        white-space: nowrap;
        overflow: visible;
        box-sizing: border-box;
        min-height: 94px;
    }
    #my-hand .card {
        flex: 0 0 auto;
    }

    /* カード・盤面デザイン */
    .pile { 
        width: 60px; height: 90px; 
        border: 2px dashed rgba(173, 214, 255, 0.62); 
        border-radius: var(--seki-radius-sm);
        margin: auto; display:flex; align-items:center; justify-content:center; 
        background: linear-gradient(155deg, rgba(6, 16, 32, 0.7), rgba(3, 10, 20, 0.56)); 
        cursor: pointer;
        box-shadow: inset 0 0 12px rgba(0, 216, 255, 0.11);
        transition: transform var(--seki-transition-fast), border-color var(--seki-transition-fast), box-shadow var(--seki-transition-fast), background var(--seki-transition-fast); 
    }
    .pile:hover {
        background: linear-gradient(155deg, rgba(8, 26, 48, 0.82), rgba(4, 14, 28, 0.74));
        border-color: var(--seki-warning);
        transform: scale(1.05);
        box-shadow: 0 0 12px rgba(255, 235, 59, 0.25), inset 0 0 14px rgba(0, 216, 255, 0.24);
    }

    .card { 
        width: 54px; height: 86px; 
        background-color: #f5fbff;
        color: #1f2a3a; 
        border-radius: 6px; 
        border: 1px solid #a3b9d6;
        box-shadow: 2px 2px 8px rgba(0,0,0,0.38); /* カードの影 */
        display: inline-flex; align-items: center; justify-content: center; 
        font-weight: bold; margin: 3px; font-size: 22px; 
        cursor: pointer; position: relative; 
        transition: transform var(--seki-transition-fast) cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow var(--seki-transition-fast), border-color var(--seki-transition-fast);
        vertical-align: bottom;
        background-size: cover; background-position: center; background-repeat: no-repeat;
    }
    /* カードの動き */
    .card:not(.selected):hover {
        transform: translateY(-8px) rotate(2deg);
        z-index: 5;
        border-color: rgba(0, 216, 255, 0.55);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.45), 0 0 10px rgba(0, 216, 255, 0.18);
    }
    
    .card.num { color: #1565c0; font-family: var(--font-display-strong); }
    .card.sym { color: #c62828; font-size: 11px; text-align:center; line-height:1.1; letter-spacing: -0.5px;}
    /*.card[data-val="0"] { border: 2px solid #ab47bc; color: #8e24aa; background: #f3e5f5; }*/

    /* 選択状態：光るエフェクト */
    .selected { 
        transform: translateY(-20px) scale(1.1) !important; 
        border: 2px solid var(--seki-warning); 
        box-shadow: 0 0 15px rgba(255, 235, 59, 0.9), 0 10px 20px rgba(0,0,0,0.5); 
        z-index: 100; 
    }
    .card.has-img { color: transparent !important; font-size: 0; border: 2px solid rgba(255, 255, 255, 0.9); }
    @media (hover: none) and (pointer: coarse) {
        .card:not(.selected):hover {
            transform: none;
            border-color: #a3b9d6;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.38);
        }
        .pile:hover {
            background: linear-gradient(155deg, rgba(6, 16, 32, 0.7), rgba(3, 10, 20, 0.56));
            border-color: rgba(173, 214, 255, 0.62);
            transform: none;
            box-shadow: inset 0 0 12px rgba(0, 216, 255, 0.11);
        }
        #my-hand .card {
            transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
        }
        #my-hand .selected {
            transform: translateY(-10px) scale(1.03) !important;
            box-shadow: 0 0 10px rgba(255, 235, 59, 0.72), 0 6px 14px rgba(0,0,0,0.44);
        }
    }

    /* 他プレイヤー表示 */
    /* --- 円卓レイアウト用CSS --- */
    /* --- アニメーション定義 (光る演出用) --- */
    @keyframes pulse-yellow {
        0% { box-shadow: 0 0 5px #ffeb3b; }
        50% { box-shadow: 0 0 15px #ffeb3b, 0 0 5px rgba(255,235,59,0.5) inset; }
        100% { box-shadow: 0 0 5px #ffeb3b; }
    }
    @keyframes blink-red {
        0% { border-color: #ff1744; background-color: rgba(255, 23, 68, 0.1); }
        50% { border-color: #b71c1c; background-color: rgba(255, 23, 68, 0.3); }
        100% { border-color: #ff1744; background-color: rgba(255, 23, 68, 0.1); }
    }
    @keyframes blink-orange {
        0% { border-color: #ff9800; }
        50% { border-color: #ffe0b2; }
        100% { border-color: #ff9800; }
    }
    @keyframes pulse-badge { from{transform:scale(1);} to{transform:scale(1.3);} }

    /* --- 円卓レイアウト用 (画面分割) --- */
    #game-table {
        /* 残りの高さを全部使う */
        flex: 1;
        
        display: flex;
        flex-direction: column;
        width: 100%;
        position: relative;
        
        /* ★ここが重要：入り切らない場合はここだけスクロールさせる */
        overflow-y: visible; 
        
        /* ★ログバー(35px)と被らないよう、底上げする */
        padding-bottom: 80px !important; 
        
        /* 横のパディング */
        padding-left: 10px;
        padding-right: 10px;
        box-sizing: border-box;
        
        /* 高さ指定（calc）は削除して auto に */
        height: auto !important; 
    }

    /* エリア定義 */
    #area-top {
        height: 15%; /* 画面上部 */
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 10px;
        padding-bottom: 5px;
    }

    #area-middle {
        flex: 1; /* 残りのスペース */
        display: flex;
        align-items: center;
        /* justify-content: space-between;  ← これを削除して */
        justify-content: center;         /* ← これに変更！ */
        gap: 5px;                        /* ← 間隔を少し空ける */
        width: 100%;
        position: relative;
    }
    /* ↓↓↓ 追加: 自分の手番のときの強調表示 ↓↓↓ */
    #my-area.current-turn {
        border: 2px solid var(--seki-warning) !important;
        box-shadow: 0 0 30px rgba(255, 235, 59, 0.45), 0 0 20px rgba(0, 216, 255, 0.2);
        background: linear-gradient(155deg, rgba(42, 38, 8, 0.88), rgba(18, 25, 38, 0.78));
        transform: translateY(-2px);                /* ほんの少し浮き上がる */
        transition: all 0.3s ease;
    }

    /* サイドバー (左右のプレイヤー) */
    /* --- プレイヤーエリアの枠組み --- */
    /* サイドバーの幅を少し広げて、プレイヤーボックスが入るようにする */
    /* --- 1. エリア定義の調整 (ボックス拡大に合わせて広げる) --- */
    
    /* 左右のサイドバー：幅を広げる */
    .player-zone.col {
        width: 150px; /* 80px -> 110px -> 130px に拡大 */
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 10px;
        z-index: 10; /* 中央フィールドより手前に表示 */
    }

    /* 上部エリア：高さを確保 */
    #area-top {
        height: auto;
        min-height: 130px; /* ボックスがしっかり入る高さ */
        display: flex;
        justify-content: center;
        align-items: flex-end; /* 下揃え */
        gap: 12px; /* 横並び時の隙間 */
        padding-bottom: 5px;
        z-index: 10;
    }
    /* ↓↓↓ 追加: 自分のネームプレート（ヘッダー風） ↓↓↓ */
    .my-name-plate {
        background: linear-gradient(155deg, rgba(6, 18, 35, 0.82), rgba(4, 11, 23, 0.74));
        border-bottom: 1px solid rgba(0, 216, 255, 0.28);
        padding: 8px 15px;
        margin: -15px -15px 10px -15px;       /* 親のpadding(15px)を相殺して上端に密着 */
        border-radius: var(--seki-radius-lg) var(--seki-radius-lg) 0 0;
        
        font-weight: bold;
        font-size: 14px;
        text-align: left;
        display: flex;
        align-items: center;
        gap: 6px;
        color: var(--seki-text-main);
        text-shadow: 0 1px 2px rgba(0,0,0,0.8), 0 0 8px rgba(0, 216, 255, 0.2);
        position: relative;
        overflow: visible;
    }
    .my-host-icon {
        color: #ffd700;
        margin-right: 4px;
    }
    .my-name-link {
        cursor: pointer;
        text-decoration: underline;
        text-decoration-thickness: 1px;
        text-underline-offset: 2px;
    }
    .role-attr-strategy {
        --role-accent: var(--seki-s);
        --role-accent-rgb: 0, 216, 255;
    }
    .role-attr-efficiency {
        --role-accent: var(--seki-e);
        --role-accent-rgb: 52, 247, 141;
    }
    .role-attr-killer {
        --role-accent: var(--seki-k);
        --role-accent-rgb: 255, 53, 94;
    }
    .my-role-chip {
        margin-left: 10px;
        color: var(--role-accent, #8fefff);
        text-shadow: 0 0 8px rgba(var(--role-accent-rgb, 0, 216, 255), 0.32);
    }
    .my-role-chip.used {
        opacity: 0.6;
        filter: saturate(0.82);
    }
    .my-reset-badge {
        margin-left: 10px;
        font-size: 12px;
        vertical-align: middle;
        display: inline-block;
    }
    .my-rank-badge {
        color: #ffd700;
        margin-left: 10px;
        text-shadow: 0 0 6px rgba(255, 196, 0, 0.5);
    }

    /* --- 2. プレイヤープレート本体 (サイズアップ) --- */
    .p-box-new {
        width: 140px;            /* 横幅 */
        height: 110px;           /* ★高さを数値で強制固定！ */
        
        display: flex;
        flex-direction: column;  /* 縦並び */
        justify-content: space-between; /* 上・中・下をきっちり配置 */
        
        background: linear-gradient(150deg, rgba(6, 16, 32, 0.9), rgba(4, 11, 23, 0.84));
        border: 1px solid rgba(0, 216, 255, 0.32);
        border-radius: 10px;
        box-shadow: 0 6px 14px rgba(0,0,0,0.6);
        transition: transform var(--seki-transition-mid), border-color var(--seki-transition-mid), box-shadow var(--seki-transition-mid), background var(--seki-transition-mid);
        overflow: visible !important;        /* ★はみ出した分はカット（これで伸びない） */
    }

    /* 手番のときの強調 */
    .p-box-new.current {
        border: 2px solid var(--seki-warning);
        box-shadow: 0 0 20px rgba(255, 235, 59, 0.65), 0 0 14px rgba(0, 216, 255, 0.2);
        background: linear-gradient(145deg, rgba(61, 54, 14, 0.92), rgba(12, 22, 36, 0.85));
        z-index: 100;
        /* currentで拡大させるとレイアウトが崩れることがあるので、
           scaleではなく translate や shadow だけで目立たせるのが安全ですが、
           一旦 scale(1.05) はそのままでいきます */
        transform: scale(1.05);
    }

    /* --- 3. 内部パーツ (文字サイズ拡大) --- */

    /* ヘッダー（名前） */
    .p-header {
        height: 26px;            /* ★高さ固定 */
        line-height: 26px;       /* 垂直中央 */
        padding: 0 4px;
        background: rgba(8, 26, 48, 0.64);
        border-bottom: 1px solid rgba(0, 216, 255, 0.24);
        border-top-left-radius: 9px;
        border-top-right-radius: 9px;
        font-size: 13px;
        font-weight: bold;
        color: #f3fbff;
        white-space: nowrap;     /* 改行させない */
        overflow: hidden;
        text-overflow: ellipsis; /* 長すぎたら...にする */
    }

    .p-host-mark { color: #ffd700; margin-right: 4px; font-size: 13px; }

    /* --- 3段固定レイアウト用の修正 --- */

    /* 中段：手札数とステータスを横並びに */
    .p-body {
        flex: 1;                 /* ★余った高さを全部使う */
        display: flex;
        flex-direction: row;     /* 横並び */
        justify-content: space-between;
        align-items: center;
        padding: 0 8px;
        border-bottom: 1px solid rgba(0, 216, 255, 0.2);
    }

    /* 左側：手札枚数（フォントサイズはそのまま維持） */
    .p-hand-count {
        flex-shrink: 0 !important;      /* 横幅が足りなくても、絶対に縮めない！ */
        white-space: nowrap !important; /* 勝手に改行させない！ */
        font-size: 24px;         /* ★そのまま！ */
        font-weight: 800;
        color: #fff;
        display: flex; 
        align-items: center; 
        gap: 2px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }
    .p-hand-count.count-danger {
        color: #ff1744;
        text-shadow: 0 0 10px #ff1744;
        animation: blink-text 0.6s infinite;
    }
    .p-hand-count.count-warning {
        color: #ffeb3b;
        text-shadow: 0 0 10px #ffeb3b;
        animation: blink-text 1.2s infinite;
    }
    .p-hand-count.count-passed {
        color: #78909c;
    }
    .p-hand-icon { font-size: 16px; opacity: 0.8; margin-right: 2px; } 

    /* 右側：ステータス表示エリア */
    .p-status-area {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        justify-content: center;
    }
    
    /* ステータス文字のスタイル定義 */
    .status-text {
        font-size: 11px;
        font-weight: 400;
        letter-spacing: 1px;
    }
    
    .status-normal { color: #8aa0b8; }
    
    .status-reset { 
        color: #ffeb3b; 
        animation: pulse-yellow 2s infinite; 
        border: 1px solid #ffeb3b;
        padding: 0 4px;
        border-radius: 4px;
        background: rgba(0,0,0,0.3);
    }
    
    .status-rank {
        color: #ffd700;
        font-size: 14px; /* 順位は少し大きく */
        text-shadow: 0 0 5px #ff9800;
    }

    /* 下段：役職エリア（高さ固定） */
    .p-role-row {
        height: 30px;            /* ★高さ固定 */
        display: flex;
        justify-content: center;
        align-items: center;
        background: rgba(4, 12, 24, 0.5);
        padding: 0 4px;
        border-bottom-left-radius: 9px;
        border-bottom-right-radius: 9px;
    }

    /* --- 役職バッジ（視認性アップ版） --- */
    .role-badge-pill {
        font-size: 14px;       /* 擬似太字を避ける分、少し大きくする */
        font-weight: 400;      /* WDXLの擬似太字を使わない */
        
        padding: 2px 0;        /* 上下は詰めて文字スペース確保 */
        width: 95%;            /* 横幅いっぱいに広げる */
        
        /* 属性色グラデーション */
        background:
            linear-gradient(
                135deg,
                rgba(9, 24, 40, 0.92),
                rgba(var(--role-accent-rgb, 0, 216, 255), 0.72) 52%,
                rgba(var(--role-accent-rgb, 0, 216, 255), 0.95)
            );
        border: 1px solid rgba(var(--role-accent-rgb, 0, 216, 255), 0.86);
        
        /* ほんのり発光させて目立たせる */
        box-shadow: 0 0 8px rgba(var(--role-accent-rgb, 0, 216, 255), 0.38);
        
        color: #fff;
        text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        
        /* 中央揃え */
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 12px;
        letter-spacing: 0.08em;
    }
    .p-box-wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .p-box-new.with-bubble {
        position: relative;
    }
    .p-header.clickable {
        cursor: pointer;
        text-decoration: underline;
        text-decoration-thickness: 1px;
        text-underline-offset: 2px;
    }
    .role-activate-btn {
        margin-top: 8px;
        min-width: 112px;
        min-height: 32px;
        padding: 6px 12px;
        line-height: 1.2;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        background: linear-gradient(
            135deg,
            rgba(8, 22, 40, 0.96),
            rgba(var(--role-accent-rgb, 0, 216, 255), 0.72) 56%,
            rgba(var(--role-accent-rgb, 0, 216, 255), 0.92)
        );
        border-color: rgba(var(--role-accent-rgb, 0, 216, 255), 0.72);
        box-shadow:
            0 3px 10px rgba(0, 0, 0, 0.35),
            0 0 10px rgba(var(--role-accent-rgb, 0, 216, 255), 0.24);
        color: #effbff;
    }
    .role-activate-btn:hover:not(:disabled) {
        border-color: rgba(var(--role-accent-rgb, 0, 216, 255), 0.9);
        box-shadow:
            0 6px 16px rgba(0, 0, 0, 0.45),
            0 0 14px rgba(var(--role-accent-rgb, 0, 216, 255), 0.28);
    }
    .role-status-badge {
        font-size: 11px;
        color: var(--seki-warning);
        margin-top: 5px;
        font-weight: bold;
    }
    .role-card.is-used {
        filter: saturate(0.75) brightness(0.84);
        opacity: 0.7;
    }

    /* 正体不明のとき（ROLE: ???）も見やすく */
    .role-unknown {
        font-size: 11px;
        /* 暗いグレーではなく、半透明の白にして読みやすくする */
        color: rgba(255, 255, 255, 0.6); 
        font-weight: bold;
        letter-spacing: 2px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    /* 修正: 役職の補足情報（手品師のスキル名など）を横並びにする */
    .role-sub { 
        font-size: 13px; 
        display: inline;      /* 横に並べる */
        color: inherit;
        text-shadow: inherit;
        opacity: 1; 
        margin-left: 4px;
    }
    /* --- 4. 公開カード (ミニカードも拡大) --- */
    .p-revealed-container {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 3px;
        margin-top: 6px;
        width: 140px; /* ボックス幅に合わせる */
    }
    .mini-card {
        width: 24px; height: 36px; /* 18x26 -> 24x36 に拡大 */
        border-radius: 4px;
        background: #fff;
        color: #333;
        font-size: 14px; /* 数字も読みやすく */
        font-weight: bold;
        line-height: 36px;
        text-align: center;
        border: 1px solid #999;
        box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    }
    /* 0のカード */
    /*.mini-card[data-val="0"] { border: 1px solid #ab47bc; color: #8e24aa; background: #f3e5f5; }*/

    /* --- その他微調整 --- */
    /* 自分エリアが隠れないようにマージン確保 */
    /* 中央フィールド（ゾーン分けレイアウト修正） */
    #field-center {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between; /* 上下に要素を分散 */
        position: relative;
        
        background: linear-gradient(155deg, rgba(6, 16, 32, 0.62), rgba(3, 9, 20, 0.54));
        border-radius: 20px;
        box-shadow: inset 0 0 22px rgba(0, 216, 255, 0.11), 0 6px 16px rgba(0,0,0,0.28);
        border: 1px solid rgba(0, 216, 255, 0.18);
        
        padding: 5px;
        margin: 0 5px;
        z-index: 1;
        overflow: hidden;
    }
    #role-draft-monitor {
        --role-draft-monitor-gap: 6px;
        --role-draft-monitor-padding: 8px;
        --role-draft-stage-gap: 6px;
        --role-draft-headline-padding-y: 4px;
        --role-draft-headline-padding-x: 7px;
        --role-draft-headline-font-size: 16px;
        --role-draft-choice-gap: 4px;
        --role-draft-card-min-height: 64px;
        --role-draft-card-padding-y: 7px;
        --role-draft-card-padding-x: 7px;
        --role-draft-card-gap: 3px;
        --role-draft-group-font-size: 12px;
        --role-draft-role-font-size: clamp(14px, 3vw, 22px);
        --role-draft-role-line-height: 1.22;
        --role-draft-role-jp-font-size: 20px;
        --role-draft-placeholder-font-size: 11px;
        --role-draft-footer-gap: 6px;
        --role-draft-footer-padding-y: 5px;
        --role-draft-footer-padding-x: 7px;
        --role-draft-selected-font-size: 16px;
        --role-draft-confirm-font-size: 11px;
        --role-draft-confirm-padding-y: 3px;
        --role-draft-confirm-padding-x: 8px;
        --role-draft-confirm-min-width: 72px;
        --role-draft-confirm-min-height: 30px;
        position: absolute;
        inset: 0;
        z-index: 45;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: stretch;
        gap: var(--role-draft-monitor-gap);
        padding: var(--role-draft-monitor-padding);
        box-sizing: border-box;
        border-radius: 18px;
        border: 1px solid rgba(0, 216, 255, 0.25);
        background:
            radial-gradient(circle at 18% 16%, rgba(0, 216, 255, 0.16), transparent 42%),
            radial-gradient(circle at 84% 22%, rgba(255, 53, 94, 0.12), transparent 36%),
            linear-gradient(150deg, rgba(2, 7, 14, 0.97), rgba(1, 5, 10, 0.98));
        color: #dff6ff;
        overflow: hidden;
    }
    #role-draft-monitor.hidden {
        display: none !important;
    }
    #role-draft-monitor::before {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
        background: repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.03) 0px,
            rgba(255, 255, 255, 0.03) 1px,
            rgba(0, 0, 0, 0) 1px,
            rgba(0, 0, 0, 0) 4px
        );
        opacity: 0.26;
    }
    #role-draft-monitor.phase-noise-out {
        animation: roleDraftNoiseOut 500ms steps(10, end) 1000ms forwards;
    }
    #role-draft-monitor.phase-noise-out::before {
        opacity: 0.6;
        animation: roleDraftNoiseFlicker 120ms steps(2, end) 1000ms infinite;
    }
    .role-draft-stage {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: var(--role-draft-stage-gap);
        flex: 1;
        min-height: 0;
    }
    .role-draft-headline {
        margin: 0;
        padding: var(--role-draft-headline-padding-y) var(--role-draft-headline-padding-x);
        border-radius: 10px;
        border: 1px solid rgba(0, 216, 255, 0.32);
        background: rgba(2, 10, 20, 0.8);
        font-size: var(--role-draft-headline-font-size) !important;
        line-height: 1.25;
        letter-spacing: 0.05em;
        text-shadow: 0 0 8px rgba(0, 216, 255, 0.28);
    }
    .role-draft-logo-wrap {
        flex: 1;
        min-height: 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .role-draft-logo {
        width: min(82%, 380px);
        max-height: 58%;
        object-fit: contain;
        opacity: 0;
        filter: drop-shadow(0 0 10px rgba(0, 216, 255, 0.35));
        animation: roleDraftLogoFade 1200ms cubic-bezier(0.2, 0.7, 0.2, 1) forwards;
    }
    .role-draft-choice-row {
        display: flex;
        flex-direction: column;
        gap: var(--role-draft-choice-gap);
        width: 100%;
        min-height: 0;
        align-items: stretch;
        flex: 1;
    }
    .role-draft-card {
        flex: 1 1 0;
        min-width: 0;
        min-height: var(--role-draft-card-min-height);
        position: relative;
        isolation: isolate;
        overflow: hidden;
        border-radius: 10px;
        border: 1px solid rgba(var(--role-accent-rgb, 0, 216, 255), 0.54);
        background: linear-gradient(
            140deg,
            rgba(var(--role-accent-rgb, 0, 216, 255), 0.22),
            rgba(3, 10, 21, 0.9) 65%
        );
        color: #eff6ff;
        padding: 0;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: center;
        gap: var(--role-draft-card-gap);
        transition: border-color 0.18s ease, box-shadow 0.18s ease, opacity 0.25s ease;
        touch-action: manipulation;
    }
    .role-draft-card-media {
        position: absolute;
        inset: 0;
        z-index: 0;
        pointer-events: none;
    }
    .role-draft-card-media img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center 12%;
        opacity: 0.34;
        filter: saturate(0.82) contrast(1.08);
    }
    .role-draft-card-media::after {
        content: "";
        position: absolute;
        inset: 0;
        background:
            linear-gradient(160deg, rgba(2, 10, 20, 0.32), rgba(2, 10, 20, 0.86) 72%),
            radial-gradient(circle at 50% 8%, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0) 50%);
    }
    .role-draft-card-inner {
        position: relative;
        z-index: 1;
        min-height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        gap: var(--role-draft-card-gap);
        padding: var(--role-draft-card-padding-y) var(--role-draft-card-padding-x);
        box-sizing: border-box;
    }
    .role-draft-card.selectable {
        cursor: pointer;
    }
    .role-draft-card.selectable:hover {
        border-color: rgba(var(--role-accent-rgb, 0, 216, 255), 0.9);
    }
    .role-draft-card.selected {
        border-color: rgba(255, 235, 59, 0.92);
        transform: none !important;
        box-shadow: inset 0 0 0 2px rgba(255, 235, 59, 0.86), 0 0 12px rgba(255, 235, 59, 0.28);
    }
    .role-draft-card.selectable:active {
        transform: none !important;
    }
    .role-draft-card.selected .role-draft-card-media img {
        opacity: 0.44;
    }
    .role-draft-card.fade-out {
        pointer-events: none;
        will-change: opacity;
        animation: roleDraftCardFadeSimple 420ms ease-out forwards;
        transform: none !important;
        filter: none !important;
    }
    .role-draft-card.fade-out .role-draft-card-inner {
        animation: none !important;
        transform: none !important;
        filter: none !important;
    }
    .role-draft-card.fade-out .role-draft-card-media img {
        animation: none !important;
        transform: none !important;
        filter: none !important;
    }
    .role-draft-card.fade-out::before {
        content: none !important;
        animation: none !important;
        opacity: 0 !important;
    }
    .role-draft-card.fade-out::after {
        content: none !important;
        animation: none !important;
        opacity: 0 !important;
    }
    .role-draft-card.disabled {
        opacity: 0.76;
        cursor: default;
    }
    .role-draft-group {
        font-size: var(--role-draft-group-font-size);
        color: var(--role-accent, #9ce8ff);
        letter-spacing: 0.08em;
        line-height: 1.15;
        text-transform: uppercase;
        text-shadow: 0 0 6px rgba(var(--role-accent-rgb, 0, 216, 255), 0.35);
    }
    .role-draft-role {
        font-size: var(--role-draft-role-font-size);
        font-family: var(--font-display-strong);
        display: block;
        letter-spacing: 0.04em;
        line-height: var(--role-draft-role-line-height);
        padding-bottom: 1px;
        white-space: nowrap;
        overflow: hidden;
        word-break: normal;
        text-overflow: ellipsis;
    }
    .role-draft-role-jp {
        font-size: var(--role-draft-role-jp-font-size) !important;
        line-height: 1.35;
        color: #d9ebff;
    }
    .role-draft-summary {
        font-size: 10px;
        line-height: 1.35;
        color: #b8ccdf;
    }
    .role-draft-placeholder {
        display: block;
        font-size: var(--role-draft-placeholder-font-size);
        color: rgba(239, 246, 255, 0.86);
        text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
        letter-spacing: 0.08em;
    }
    .role-draft-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--role-draft-footer-gap);
        flex-wrap: nowrap;
        padding: var(--role-draft-footer-padding-y) var(--role-draft-footer-padding-x);
        border-radius: 10px;
        border: 1px solid rgba(0, 216, 255, 0.28);
        background: rgba(2, 10, 20, 0.82);
    }
    .role-draft-selected-label {
        flex: 1;
        min-width: 0;
        font-size: var(--role-draft-selected-font-size) !important;
        line-height: 1.3;
        color: #d9ebff;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .role-draft-confirm-btn {
        border: 1px solid rgba(0, 216, 255, 0.66);
        border-radius: 14px;
        background: linear-gradient(135deg, #0f314d, #166d98 46%, #00d8ff);
        color: #f4fbff;
        padding: var(--role-draft-confirm-padding-y) var(--role-draft-confirm-padding-x) !important;
        min-height: var(--role-draft-confirm-min-height) !important;
        min-width: var(--role-draft-confirm-min-width) !important;
        font-size: var(--role-draft-confirm-font-size) !important;
        font-weight: 700;
        letter-spacing: 0.05em;
        font-family: var(--font-ui);
        cursor: pointer;
        touch-action: manipulation;
    }
    .role-draft-confirm-btn:disabled {
        cursor: not-allowed;
        opacity: 0.52;
        background: rgba(92, 110, 128, 0.72);
        border-color: rgba(132, 147, 168, 0.62);
    }
    #role-draft-monitor.role-draft-density-compact {
        --role-draft-monitor-padding: 6px;
        --role-draft-monitor-gap: 4px;
        --role-draft-stage-gap: 4px;
        --role-draft-headline-padding-y: 3px;
        --role-draft-headline-padding-x: 6px;
        --role-draft-headline-font-size: 15px;
        --role-draft-choice-gap: 3px;
        --role-draft-card-min-height: 56px;
        --role-draft-card-padding-y: 5px;
        --role-draft-card-padding-x: 5px;
        --role-draft-card-gap: 2px;
        --role-draft-group-font-size: 11px;
        --role-draft-role-font-size: clamp(13px, 2.8vw, 20px);
        --role-draft-role-jp-font-size: 18px;
        --role-draft-placeholder-font-size: 10px;
        --role-draft-footer-gap: 4px;
        --role-draft-footer-padding-y: 4px;
        --role-draft-footer-padding-x: 6px;
        --role-draft-selected-font-size: 15px;
        --role-draft-confirm-min-width: 68px;
        --role-draft-confirm-font-size: 10.5px;
        --role-draft-confirm-padding-y: 2px;
        --role-draft-confirm-padding-x: 7px;
        --role-draft-confirm-min-height: 28px;
    }
    #role-draft-monitor.role-draft-density-xcompact {
        --role-draft-monitor-padding: 5px;
        --role-draft-monitor-gap: 3px;
        --role-draft-stage-gap: 3px;
        --role-draft-headline-padding-y: 2px;
        --role-draft-headline-padding-x: 5px;
        --role-draft-headline-font-size: 14px;
        --role-draft-choice-gap: 2px;
        --role-draft-card-min-height: 50px;
        --role-draft-card-padding-y: 4px;
        --role-draft-card-padding-x: 4px;
        --role-draft-card-gap: 2px;
        --role-draft-group-font-size: 10px;
        --role-draft-role-font-size: clamp(12px, 2.6vw, 18px);
        --role-draft-role-jp-font-size: 16px;
        --role-draft-placeholder-font-size: 9.5px;
        --role-draft-footer-gap: 3px;
        --role-draft-footer-padding-y: 3px;
        --role-draft-footer-padding-x: 5px;
        --role-draft-selected-font-size: 14px;
        --role-draft-confirm-min-width: 64px;
        --role-draft-confirm-font-size: 9.5px;
        --role-draft-confirm-padding-y: 2px;
        --role-draft-confirm-padding-x: 6px;
        --role-draft-confirm-min-height: 26px;
    }
    .role-draft-text-block {
        flex: 1;
        min-height: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 8px;
        text-align: center;
        padding: 10px 8px;
        overflow-y: auto;
    }
    .role-draft-text-block.role-draft-text-block-unused {
        justify-content: flex-start;
        align-items: stretch;
        text-align: center;
        padding-top: 8px;
        padding-bottom: 8px;
    }
    .role-draft-maintext {
        font-family: var(--font-display-strong);
        font-size: clamp(18px, 4.5vw, 34px);
        letter-spacing: 0.08em;
        color: #e9fbff;
        text-shadow: 0 0 10px rgba(0, 216, 255, 0.42), 0 0 18px rgba(52, 247, 141, 0.22);
    }
    .role-draft-maintext.role-draft-maintext-system-online {
        font-size: clamp(14px, 3.4vw, 22px);
        letter-spacing: 0.03em;
        line-height: 1.3;
        max-width: 96%;
        overflow-wrap: anywhere;
    }
    .role-draft-subtext {
        font-size: 14px;
        color: #b9d5ea;
        max-width: 95%;
    }
    .role-draft-unused-absence-note {
        font-family: var(--font-readable);
        font-size: clamp(10px, 2.6vw, 13px);
        line-height: 1.25;
        letter-spacing: 0.02em;
        color: #dff0ff;
        white-space: nowrap;
        max-width: 96%;
    }
    .role-draft-transition-meter {
        position: relative;
        width: min(92%, 520px);
        height: 12px;
        border-radius: 999px;
        border: 1px solid rgba(0, 216, 255, 0.62);
        background:
            linear-gradient(180deg, rgba(12, 29, 52, 0.9), rgba(3, 12, 24, 0.92)),
            repeating-linear-gradient(90deg, rgba(0, 216, 255, 0.12) 0 1px, rgba(0, 216, 255, 0) 1px 10px);
        box-shadow:
            inset 0 0 12px rgba(0, 0, 0, 0.58),
            inset 0 0 24px rgba(0, 216, 255, 0.12),
            0 0 16px rgba(0, 216, 255, 0.18);
        overflow: hidden;
    }
    .role-draft-transition-meter::before,
    .role-draft-transition-meter::after {
        content: "";
        position: absolute;
        inset: 0;
        pointer-events: none;
    }
    .role-draft-transition-meter::before {
        background: repeating-linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.08) 0 1px,
            rgba(255, 255, 255, 0) 1px 3px
        );
        opacity: 0.22;
        mix-blend-mode: screen;
        animation: roleDraftTransitionScan 900ms linear infinite;
    }
    .role-draft-transition-meter::after {
        background: repeating-linear-gradient(
            90deg,
            rgba(0, 216, 255, 0.28) 0 1px,
            rgba(0, 216, 255, 0) 1px 14px
        );
        opacity: 0.55;
        animation: roleDraftTransitionGridFlicker 180ms steps(2, end) infinite;
    }
    .role-draft-transition-meter-fill {
        position: relative;
        width: 100%;
        height: 100%;
        transform-origin: left center;
        transform: scaleX(0);
        background:
            linear-gradient(90deg, rgba(0, 216, 255, 0.94), rgba(52, 247, 141, 0.94) 50%, rgba(158, 236, 255, 0.98)),
            repeating-linear-gradient(90deg, rgba(6, 18, 34, 0) 0 8px, rgba(6, 18, 34, 0.24) 8px 10px);
        background-size: 200% 100%, 20px 100%;
        box-shadow: 0 0 16px rgba(0, 216, 255, 0.55), inset 0 0 10px rgba(255, 255, 255, 0.24);
        animation: roleDraftTransitionLoad 1000ms linear forwards, roleDraftTransitionSweep 260ms linear infinite;
    }
    .role-draft-transition-meter-fill::after {
        content: "";
        position: absolute;
        top: 0;
        right: -42px;
        bottom: 0;
        width: 42px;
        background: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0),
            rgba(255, 255, 255, 0.58),
            rgba(255, 255, 255, 0)
        );
        filter: blur(0.4px);
        animation: roleDraftTransitionShine 600ms linear infinite;
    }
    .role-draft-unused-list {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    .role-draft-unused-group {
        border-radius: 10px;
        border: 1px solid rgba(var(--role-accent-rgb, 0, 216, 255), 0.34);
        background: linear-gradient(
            145deg,
            rgba(var(--role-accent-rgb, 0, 216, 255), 0.14),
            rgba(3, 10, 21, 0.9) 66%
        );
        box-shadow: inset 0 0 12px rgba(var(--role-accent-rgb, 0, 216, 255), 0.08);
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    .role-draft-unused-group-title {
        display: flex;
        align-items: center;
        gap: 7px;
        text-align: left;
        font-size: 11px;
        letter-spacing: 0.08em;
        color: var(--role-accent, #9ce8ff);
        text-shadow: 0 0 6px rgba(var(--role-accent-rgb, 0, 216, 255), 0.28);
    }
    .role-draft-unused-group-tag {
        display: inline-flex;
        justify-content: center;
        align-items: center;
        min-width: 20px;
        height: 18px;
        padding: 0 5px;
        border-radius: 999px;
        border: 1px solid rgba(var(--role-accent-rgb, 0, 216, 255), 0.76);
        background: rgba(var(--role-accent-rgb, 0, 216, 255), 0.2);
        color: #f2fbff;
        font-family: var(--font-display-strong);
        font-size: 10px;
        line-height: 1;
        box-sizing: border-box;
    }
    .role-draft-unused-group-rows {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    .role-draft-unused-item {
        position: relative;
        width: 100%;
        border-radius: 8px;
        border: 1px solid rgba(var(--role-accent-rgb, 0, 216, 255), 0.4);
        background: linear-gradient(
            120deg,
            rgba(var(--role-accent-rgb, 0, 216, 255), 0.1),
            rgba(6, 16, 32, 0.9) 52%,
            rgba(2, 8, 18, 0.94)
        );
        color: #eef4f9;
        display: grid;
        grid-template-columns: minmax(0, 1fr) auto;
        grid-template-areas:
            "main meta"
            "sub meta";
        column-gap: 8px;
        row-gap: 2px;
        align-items: center;
        text-align: left;
        padding: 6px 9px 6px 13px;
        cursor: pointer;
        opacity: 0.92;
        transition: border-color 0.18s ease, box-shadow 0.18s ease, opacity 0.18s ease, transform 0.18s ease;
        box-sizing: border-box;
    }
    .role-draft-unused-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 7px;
        bottom: 7px;
        width: 3px;
        border-radius: 0 3px 3px 0;
        background: rgba(var(--role-accent-rgb, 0, 216, 255), 0.9);
        box-shadow: 0 0 8px rgba(var(--role-accent-rgb, 0, 216, 255), 0.42);
    }
    .role-draft-unused-item-main {
        grid-area: main;
        min-width: 0;
        font-size: 14px;
        line-height: 1.2;
        font-weight: 700;
        color: #f5fbff;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .role-draft-unused-item-sub {
        grid-area: sub;
        min-width: 0;
        font-size: 10px;
        line-height: 1.2;
        color: #c8e1f7;
        letter-spacing: 0.04em;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .role-draft-unused-item-meta {
        grid-area: meta;
        align-self: center;
        font-size: 9px;
        line-height: 1.2;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--role-accent, #9ce8ff);
        text-shadow: 0 0 6px rgba(var(--role-accent-rgb, 0, 216, 255), 0.32);
        white-space: nowrap;
    }
    .role-draft-unused-item:hover {
        opacity: 1;
        border-color: rgba(var(--role-accent-rgb, 0, 216, 255), 0.88);
        box-shadow: 0 0 12px rgba(var(--role-accent-rgb, 0, 216, 255), 0.28), inset 0 0 10px rgba(var(--role-accent-rgb, 0, 216, 255), 0.1);
        transform: translateY(-1px);
    }
    @media (max-width: 600px) {
        #role-draft-monitor {
            --role-draft-monitor-padding: 7px;
            --role-draft-monitor-gap: 5px;
            --role-draft-stage-gap: 5px;
            --role-draft-headline-padding-y: 3px;
            --role-draft-headline-padding-x: 6px;
            --role-draft-headline-font-size: 15px;
            --role-draft-card-min-height: 52px;
            --role-draft-card-padding-y: 5px;
            --role-draft-card-padding-x: 5px;
            --role-draft-footer-padding-y: 4px;
            --role-draft-footer-padding-x: 6px;
            --role-draft-selected-font-size: 15px;
            --role-draft-confirm-min-width: 70px;
            --role-draft-confirm-font-size: 10.5px;
            --role-draft-confirm-padding-y: 3px;
            --role-draft-confirm-padding-x: 7px;
            --role-draft-confirm-min-height: 28px;
        }
        .role-draft-unused-list {
            gap: 6px;
        }
        .role-draft-text-block.role-draft-text-block-unused {
            padding-top: 6px;
            padding-bottom: 6px;
        }
        .role-draft-unused-absence-note {
            font-size: clamp(9.5px, 2.7vw, 12px);
        }
        .role-draft-unused-group {
            padding: 7px;
            gap: 5px;
        }
        .role-draft-unused-group-title {
            font-size: 10px;
            gap: 6px;
        }
        .role-draft-unused-group-tag {
            min-width: 18px;
            height: 16px;
            font-size: 9px;
        }
        .role-draft-unused-group-rows {
            gap: 4px;
        }
        .role-draft-unused-item {
            padding: 6px 8px 6px 11px;
            column-gap: 7px;
        }
        .role-draft-unused-item::before {
            top: 6px;
            bottom: 6px;
        }
        .role-draft-unused-item-main {
            font-size: 13px;
        }
        .role-draft-unused-item-sub {
            font-size: 9.5px;
        }
        .role-draft-unused-item-meta {
            font-size: 8.5px;
        }
    }
    @media (max-width: 420px) {
        .role-draft-unused-list {
            gap: 5px;
        }
        .role-draft-text-block.role-draft-text-block-unused {
            padding-top: 5px;
            padding-bottom: 5px;
        }
        .role-draft-unused-absence-note {
            font-size: clamp(9px, 2.9vw, 11px);
            letter-spacing: 0.01em;
        }
        .role-draft-unused-group {
            padding: 6px;
        }
        .role-draft-unused-group-title {
            font-size: 9px;
            letter-spacing: 0.06em;
        }
        .role-draft-unused-group-tag {
            min-width: 16px;
            height: 15px;
            padding: 0 4px;
            font-size: 8px;
        }
        .role-draft-unused-item {
            padding: 5px 7px 5px 10px;
            column-gap: 6px;
        }
        .role-draft-unused-item-main {
            font-size: 12px;
        }
        .role-draft-unused-item-sub {
            font-size: 9px;
        }
        .role-draft-unused-item-meta {
            font-size: 8px;
            letter-spacing: 0.08em;
        }
    }
    @media (max-height: 760px) {
        #role-draft-monitor {
            --role-draft-monitor-padding: 6px;
            --role-draft-monitor-gap: 4px;
            --role-draft-stage-gap: 4px;
            --role-draft-headline-padding-y: 3px;
            --role-draft-headline-padding-x: 6px;
            --role-draft-headline-font-size: 15px;
            --role-draft-card-min-height: 50px;
            --role-draft-card-padding-y: 5px;
            --role-draft-card-padding-x: 5px;
            --role-draft-card-gap: 2px;
            --role-draft-group-font-size: 9px;
            --role-draft-role-jp-font-size: 17px;
            --role-draft-footer-padding-y: 4px;
            --role-draft-footer-padding-x: 6px;
            --role-draft-selected-font-size: 14px;
        }
    }
    .role-badge-group-mask {
        font-size: 10px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
    }
    @keyframes roleDraftLogoFade {
        0% {
            opacity: 0;
            transform: scale(0.93) translate3d(0, 2px, 0);
            filter: drop-shadow(0 0 4px rgba(0, 216, 255, 0.22));
        }
        9% {
            opacity: 0.16;
        }
        12% {
            opacity: 0.03;
        }
        18% {
            opacity: 0.28;
            transform: scale(0.95) translate3d(-1px, 1px, 0);
        }
        22% {
            opacity: 0.1;
            transform: scale(0.95) translate3d(1px, -1px, 0);
        }
        30% {
            opacity: 0.42;
            transform: scale(0.96) translate3d(0, 0, 0);
        }
        34% {
            opacity: 0.2;
        }
        44% {
            opacity: 0.56;
            transform: scale(0.97) translate3d(-1px, 0, 0);
        }
        49% {
            opacity: 0.3;
            transform: scale(0.97) translate3d(1px, 0, 0);
        }
        62% {
            opacity: 0.72;
            transform: scale(0.985) translate3d(0, 0, 0);
        }
        68% {
            opacity: 0.55;
        }
        80% {
            opacity: 0.88;
        }
        90% {
            opacity: 0.94;
        }
        100% {
            opacity: 1;
            transform: scale(1) translate3d(0, 0, 0);
            filter: drop-shadow(0 0 12px rgba(0, 216, 255, 0.4));
        }
    }
    @keyframes roleDraftNoiseOut {
        0% {
            opacity: 1;
            transform: translate3d(0, 0, 0) scale(1);
            clip-path: inset(0 0 0 0);
        }
        78% {
            opacity: 1;
            transform: translate3d(0, 0, 0) scale(1);
            clip-path: inset(0 0 0 0);
        }
        92% {
            opacity: 0.62;
            transform: translate3d(3px, -2px, 0) scale(0.99);
            clip-path: inset(18% 0 26% 0);
        }
        100% {
            opacity: 0;
            transform: translate3d(0, 0, 0) scale(0.97);
            clip-path: inset(48% 0 52% 0);
        }
    }
    @keyframes roleDraftTransitionLoad {
        from { transform: scaleX(0); }
        to { transform: scaleX(1); }
    }
    @keyframes roleDraftTransitionSweep {
        from { background-position: 0 0, 0 0; }
        to { background-position: 42px 0, 20px 0; }
    }
    @keyframes roleDraftTransitionShine {
        from { transform: translateX(-140%); }
        to { transform: translateX(220%); }
    }
    @keyframes roleDraftTransitionScan {
        from { transform: translateY(0); }
        to { transform: translateY(3px); }
    }
    @keyframes roleDraftTransitionGridFlicker {
        0% { opacity: 0.34; }
        100% { opacity: 0.62; }
    }
    @keyframes roleDraftNoiseFlicker {
        0% { transform: translate3d(0, 0, 0); opacity: 0.22; }
        50% { transform: translate3d(-2px, 1px, 0); opacity: 0.6; }
        100% { transform: translate3d(2px, -1px, 0); opacity: 0.26; }
    }
    @keyframes roleDraftCardFadeSimple {
        from { opacity: 1; }
        to { opacity: 0; }
    }
    @keyframes roleDraftCardDisperseSmooth {
        0% {
            opacity: 1;
            transform: translate3d(0, 0, 0) scale(1);
            filter: saturate(1) brightness(1);
        }
        22% {
            opacity: 0.94;
            transform: translate3d(-1px, -1px, 0) scale(0.995);
            filter: saturate(1.03) brightness(1.04);
        }
        52% {
            opacity: 0.68;
            transform: translate3d(1px, -6px, 0) scale(0.978);
            filter: saturate(0.96) brightness(1.12) blur(0.45px);
        }
        78% {
            opacity: 0.34;
            transform: translate3d(-1px, -12px, 0) scale(0.956);
            filter: saturate(0.84) brightness(1.2) blur(1px);
        }
        100% {
            opacity: 0;
            transform: translate3d(0, -18px, 0) scale(0.94);
            filter: saturate(0.74) brightness(1.28) blur(1.5px);
        }
    }
    @keyframes roleDraftCardInnerDissolve {
        0% {
            opacity: 1;
            transform: translate3d(0, 0, 0);
            filter: blur(0);
        }
        40% {
            opacity: 0.92;
            transform: translate3d(1px, -2px, 0);
            filter: blur(0.1px);
        }
        72% {
            opacity: 0.55;
            transform: translate3d(-2px, -8px, 0);
            filter: blur(0.6px);
        }
        100% {
            opacity: 0;
            transform: translate3d(-3px, -14px, 0);
            filter: blur(1.1px);
        }
    }
    @keyframes roleDraftCardMediaDissolve {
        0% {
            opacity: 0.34;
            transform: translate3d(0, 0, 0) scale(1);
            filter: saturate(0.86) contrast(1.06);
        }
        45% {
            opacity: 0.29;
            transform: translate3d(1px, -3px, 0) scale(1.03);
            filter: saturate(0.94) contrast(1.1);
        }
        78% {
            opacity: 0.14;
            transform: translate3d(0, -8px, 0) scale(1.06);
            filter: saturate(1.02) contrast(1.12) blur(1px);
        }
        100% {
            opacity: 0;
            transform: translate3d(0, -13px, 0) scale(1.08);
            filter: saturate(1.08) contrast(1.14) blur(1.7px);
        }
    }
    @keyframes roleDraftCardParticleFine {
        0% {
            opacity: 0;
            transform: translate3d(0, 2px, 0) scale(0.9);
        }
        26% {
            opacity: 0.94;
            transform: translate3d(1px, -4px, 0) scale(1);
        }
        64% {
            opacity: 0.56;
            transform: translate3d(-2px, -15px, 0) scale(1.16);
        }
        100% {
            opacity: 0;
            transform: translate3d(1px, -24px, 0) scale(1.34);
        }
    }
    @keyframes roleDraftCardParticleMist {
        0% {
            opacity: 0;
            transform: translate3d(0, 4px, 0) scale(0.92);
        }
        30% {
            opacity: 0.9;
            transform: translate3d(-1px, -4px, 0) scale(1.02);
        }
        70% {
            opacity: 0.5;
            transform: translate3d(1px, -18px, 0) scale(1.18);
        }
        100% {
            opacity: 0;
            transform: translate3d(0, -30px, 0) scale(1.34);
        }
    }
    /* --- ゾーン分けデザイン --- */
    
    /* インジケーター（画像 + 天文学者表示） */
    #flow-indicator-row {
        display: flex;
        align-items: stretch;
        justify-content: center;
        gap: 8px;
        margin-bottom: 10px;
        width: 100%;
    }
    #indicator { 
        width: auto;
        height: 60px;         /* 右側UIと高さを揃える */
        object-fit: contain;
        
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.6);
        filter: drop-shadow(0 0 2px rgba(255,255,255,0.3));
        
        display: block;
        margin: 0;
    }
    #astronomer-indicator {
        width: 73.66px;
        height: 50px;         /* 順行/逆行画像と同じ高さ */
        padding: 4px 8px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.35);
        box-shadow: 0 3px 10px rgba(0,0,0,0.45), inset 0 0 16px rgba(120, 144, 255, 0.25);
        background:
            radial-gradient(circle at 20% 20%, rgba(255,255,255,0.26) 1px, transparent 2px),
            radial-gradient(circle at 78% 35%, rgba(255,255,255,0.22) 1px, transparent 2px),
            radial-gradient(circle at 52% 76%, rgba(255,255,255,0.18) 1px, transparent 2px),
            linear-gradient(150deg, #0d1631, #1c2f66);
        color: #e8f0ff;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        line-height: 1.05;
        text-align: center;
        user-select: none;
    }
    #astronomer-indicator.state-strongest {
        border-color: rgba(255, 214, 102, 0.8);
        box-shadow: 0 3px 10px rgba(0,0,0,0.45), 0 0 10px rgba(255, 214, 102, 0.45);
    }
    #astronomer-indicator.state-weakest {
        border-color: rgba(144, 202, 249, 0.7);
        box-shadow: 0 3px 10px rgba(0,0,0,0.45), 0 0 10px rgba(144, 202, 249, 0.4);
        filter: saturate(0.75);
    }
    #astronomer-indicator-value {
        width: 30px;
        height: 40px;
        line-height: 40px;
        border-radius: 6px;
        border: 1px solid rgba(255,255,255,0.9);
        background: linear-gradient(160deg, #fefefe, #dfe9ff);
        color: #1a237e;
        font-size: 24px;
        font-weight: 900;
        margin-top: 2px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.35);
        text-shadow: 0 0 4px rgba(103, 58, 183, 0.35);
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #astronomer-indicator-state {
        font-size: 10px;
        margin-bottom: 2px;
        font-weight: bold;
        white-space: nowrap;
        text-align: center;
    }

    /* 左右のゾーンをまとめるコンテナ */
    .field-zone-container {
        display: flex;
        justify-content: center;
        gap: 8px; /* ゾーン間の隙間 */
        width: 100%;
        flex: 1; /* 高さいっぱいに広げる */
    }

    /* 個別ゾーンの枠 */
    .field-zone {
        flex: 1; /* 左右均等 */
        border-radius: 12px;
        padding: 5px 2px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        border: 1px solid rgba(255,255,255,0.15);
        position: relative;
    }

    /* 数字ゾーン (青系) */
    .zone-num {
        background: rgba(33, 150, 243, 0.14); 
        border-color: rgba(0, 216, 255, 0.42);
    }
    /* 記号ゾーン (赤系) */
    .zone-sym {
        background: rgba(244, 67, 54, 0.12); 
        border-color: rgba(255, 53, 94, 0.4);
    }

    /* ラベル (NUMBER / SYMBOL) */
    .zone-label {
        font-size: 12px;
        font-weight: bold;
        letter-spacing: 1px;
        margin-bottom: 2px;
        opacity: 0.6;
    }

    /* 墓地スロット (少し縮小) */
    .grave-slot {
        transform: scale(0.9); 
        margin-bottom: auto; /* 山札を下に押しやる */
    }

    /* 山札エリア (アイコン化) */
    .deck-slot {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        background: rgba(0,0,0,0.34);
        padding: 4px 10px;
        border-radius: 15px;
        margin-bottom: 5px;
        cursor: default;
        border: 1px solid rgba(0, 216, 255, 0.2);
    }

    /* 山札アイコン (CSSでカード裏面を表現) */
    .deck-icon {
        width: 12px; height: 18px;
        border-radius: 2px;
        border: 1px solid #fff;
    }
    .deck-icon.num { background: repeating-linear-gradient(45deg, #1565c0, #1565c0 2px, #0d47a1 2px, #0d47a1 4px); }
    .deck-icon.sym { background: repeating-linear-gradient(45deg, #c62828, #c62828 2px, #b71c1c 2px, #b71c1c 4px); }

    /* 山札の数字 */
    .deck-count {
        font-size: 12px;
        font-weight: bold;
        color: #fff;
        text-shadow: 0 1px 2px #000;
    }

    /* 除外エリア (ゴミ箱) */
    #exclusion-area {
        margin-top: 2px;
        font-size: 11px;
        opacity: 0.8;
        cursor: pointer;
        background: rgba(3, 12, 24, 0.62);
        padding: 3px 12px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 5px;
        border: 1px solid rgba(255, 53, 94, 0.3);
        transition: background var(--seki-transition-fast), opacity var(--seki-transition-fast), border-color var(--seki-transition-fast);
    }
    #exclusion-area:hover {
        opacity: 1;
        background: rgba(6, 18, 35, 0.8);
        border-color: rgba(255, 53, 94, 0.55);
    }

    /* 残り枚数バッジも大きく */
    .p-count-badge {
        width: 24px; height: 24px;
        line-height: 24px;
        font-size: 14px;
        top: -10px; left: -10px;
    }

    /* フィールド調整 */
    #graveyard-container { display: flex; gap: 15px; align-items: center; }
    .grave-box { text-align: center; cursor: pointer; transition: transform 0.1s; }
    .grave-box:active { transform: scale(0.95); }
    .grave-label { font-size: 10px; color: #ccc; }

    /* ログエリア */
    #game-log-bar { 
        position: fixed; bottom: 0; left: 0; width: 100%; height: 35px; 
        background: linear-gradient(135deg, rgba(6, 16, 32, 0.96), rgba(4, 11, 23, 0.96));
        font-size: 13px; line-height: 35px; 
        text-align: left; padding-left: 15px; overflow: hidden; white-space: nowrap; 
        z-index: 50;
        color: var(--seki-text-main);
        cursor: pointer;
        border-top: 1px solid rgba(0, 216, 255, 0.34);
        box-shadow: 0 -2px 14px rgba(0,0,0,0.55);
    }
    
    /* 通知アニメーション */
    @keyframes flash-notify {
        0% { background-color: #ff9800; transform: scale(1); }
        50% { background-color: #f57c00; transform: scale(1.1); }
        100% { background-color: #ff9800; transform: scale(1); }
    }
    .notify-active { animation: flash-notify 1s infinite; border: 2px solid #fff !important; }
    .notify-bar {
        background-color: #ff9800 !important;
        color: white !important;
        font-weight: bold;
        letter-spacing: var(--font-ui-emphasis-tracking);
        text-shadow: var(--font-ui-emphasis-shadow);
    }

    /* モーダル */
    #modal-overlay {
        position: fixed; top:0; left:0; width:100%; height:100%;
        background: rgba(2, 7, 15, 0.74); z-index: 999;
        backdrop-filter: blur(5px);
        display: flex; justify-content: center; align-items: center;
        animation: fadeIn 0.2s ease;
        transition: background 0.2s, backdrop-filter 0.2s;
    }
    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

    #modal-overlay.board-visible {
        background: rgba(0,0,0,0.05);
        backdrop-filter: none;
    }
    #modal-overlay.modal-tone-guide {
        background: rgba(2, 10, 20, 0.62);
    }
    #modal-overlay.modal-tone-alert {
        background: rgba(36, 2, 12, 0.7);
    }

    #modal-box {
        background:
            linear-gradient(155deg, rgba(6, 16, 32, 0.9), rgba(4, 11, 23, 0.84)),
            radial-gradient(circle at 12% 18%, rgba(0, 216, 255, 0.1), transparent 34%);
        color: var(--seki-text-main);
        padding: 25px;
        border-radius: 14px;
        max-width: 90%;
        max-height: 92%;
        max-height: 88dvh;
        width: 400px;
        overflow: hidden; text-align: center; display:flex; flex-direction:column;
        font-family: var(--font-readable);
        box-shadow: var(--seki-shadow-panel), var(--seki-shadow-glow);
        border: 1px solid var(--seki-panel-border);
        transition: background 0.2s, opacity 0.2s, box-shadow 0.2s, border-color 0.2s;
    }
    #modal-box.modal-size-default { width: 400px; max-width: 90%; }
    #modal-box.modal-size-wide { width: 600px; max-width: 95%; }
    #modal-box.modal-size-narrow { width: 340px; max-width: 86%; }
    #modal-box.modal-tone-guide {
        border-color: rgba(0, 216, 255, 0.44);
    }
    #modal-box.modal-tone-alert {
        border-color: rgba(255, 53, 94, 0.6);
        box-shadow: var(--seki-shadow-panel), 0 0 22px rgba(255, 53, 94, 0.25);
    }
    #modal-overlay.board-visible #modal-box {
        background: rgba(13, 22, 40, 0.34);
        border-color: rgba(209, 231, 255, 0.75);
        box-shadow: 0 4px 14px rgba(0,0,0,0.25);
        opacity: 0.4;
    }
    #modal-title {
        margin: 0 0 12px 0;
        padding-bottom: 6px;
        border-bottom: 2px solid rgba(0, 200, 255, 0.6);
        font-family: var(--font-ui);
        font-size: 22px;
        font-weight: 700;
        letter-spacing: 0.05em;
        color: #9ce8ff;
        text-shadow: 0 0 12px rgba(125, 219, 255, 0.6);
    }
    #modal-content {
        margin-bottom: 20px;
        flex: 1 1 auto;
        min-height: 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        font-size: 14px;
        color: var(--seki-text-sub);
    }
    .modal-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; }
    .modal-btn {
        margin: 5px;
        padding: 10px 20px;
        border: 1px solid rgba(142, 182, 227, 0.45);
        border-radius: var(--seki-radius-sm);
        cursor: pointer;
        font-size: 14px;
        font-family: var(--font-ui);
        letter-spacing: var(--font-ui-emphasis-tracking);
        text-shadow: var(--font-ui-emphasis-shadow);
        color: var(--seki-text-main);
        background: linear-gradient(135deg, rgba(9, 27, 52, 0.9), rgba(6, 18, 35, 0.88));
        transition: transform var(--seki-transition-fast), box-shadow var(--seki-transition-fast), border-color var(--seki-transition-fast), filter var(--seki-transition-fast);
    }
    .modal-btn:hover:not(:disabled) {
        transform: translateY(-1px);
        border-color: rgba(0, 216, 255, 0.7);
        box-shadow: 0 5px 14px rgba(0,0,0,0.35), 0 0 10px rgba(0, 216, 255, 0.24);
        filter: saturate(1.1);
    }
    .modal-btn:disabled,
    .modal-btn.is-disabled {
        background: rgba(89, 102, 119, 0.9);
        color: rgba(239, 246, 255, 0.76);
        border-color: rgba(151, 166, 187, 0.7);
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }
    .modal-btn.primary {
        background: linear-gradient(135deg, #0f314d, #166d98 44%, #00d8ff);
        border-color: rgba(0, 216, 255, 0.7);
        color: #effbff;
        font-weight: 700;
    }
    .modal-btn.danger {
        background: linear-gradient(135deg, #7f1730, #cc244a 46%, #ff355e);
        border-color: rgba(255, 143, 166, 0.78);
        color: #fff5f8;
        font-weight: 700;
    }
    .modal-btn.ghost {
        background: rgba(12, 22, 35, 0.7);
    }
    .modal-note {
        display: block;
        font-size: 12px;
        margin-top: 8px;
        color: var(--seki-text-muted);
    }
    .modal-note.warn {
        color: #ff9f9f;
        font-weight: 700;
    }
    .modal-note.warn-block {
        margin: 0 0 8px;
    }
    .modal-note.info {
        color: #9ce8ff;
    }
    .modal-card-row {
        display: flex;
        justify-content: space-around;
        align-items: center;
        margin: 10px 0;
        gap: 8px;
    }
    .modal-card-col {
        width: 100px;
    }
    .modal-card-label {
        font-size: 12px;
        color: var(--seki-text-muted);
        margin-bottom: 4px;
    }
    .modal-notif-wrap {
        text-align: center;
    }
    .modal-notif-title {
        font-size: 16px;
        font-weight: bold;
        color: #ffadb8;
        margin: 0;
    }
    .modal-notif-arrow {
        font-size: 20px;
        color: #9cb3c9;
    }
    .modal-notif-card {
        width: 100px;
    }
    .modal-notif-card .modal-notif-card-view {
        margin: 0 auto;
        cursor: default;
    }
    .modal-notif-card .modal-notif-card-view:hover {
        transform: none;
        box-shadow: 0 0 10px rgba(87, 170, 245, 0.35);
        border-color: #70b8e8;
    }
    .modal-notif-value {
        font-size: 32px;
        font-weight: bold;
        line-height: 80px;
    }
    .modal-image-center {
        height: 80px;
        width: auto;
        display: block;
        margin: 0 auto;
    }
    .seki-section {
        margin-top: 10px;
        padding: 8px 10px;
        border-radius: var(--seki-radius-sm);
        border: 1px solid rgba(143, 176, 214, 0.35);
        background: rgba(6, 16, 32, 0.6);
    }
    .seki-section.warn {
        border-color: rgba(255, 143, 166, 0.55);
        background: rgba(72, 12, 27, 0.35);
    }
    .seki-section.info {
        border-color: rgba(0, 216, 255, 0.5);
        background: rgba(8, 26, 48, 0.42);
    }
    .seki-note {
        display: block;
        font-size: 12px;
        color: var(--seki-text-muted);
    }
    .seki-note.warn {
        color: #ffadb8;
        font-weight: 700;
    }
    .seki-scroll-panel {
        text-align: left;
        max-height: 420px;
        overflow-y: auto;
        font-size: 13px;
    }
    .seki-log-line {
        border-bottom: 1px solid rgba(143, 176, 214, 0.3);
        padding: 6px 0;
    }
    .seki-log-time {
        color: #9cb3c9;
        font-size: 12px;
        margin-right: 8px;
    }
    .seki-log-text {
        color: #d9ebff;
    }
    .seki-disabled-note {
        font-size: 12px;
        color: #ff9f9f;
        margin-top: 8px;
    }
    .seki-host-settings {
        text-align: left;
        font-size: 14px;
    }
    .seki-host-mode-box {
        margin-bottom: 15px;
        background: rgba(6, 16, 32, 0.64);
        padding: 10px;
        border-radius: var(--seki-radius-sm);
        border: 1px solid rgba(143, 176, 214, 0.32);
    }
    .seki-host-mode-item {
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    .seki-host-mode-item + .seki-host-mode-item {
        margin-top: 8px;
    }
    .seki-host-mode-item input {
        margin: 0 8px 0 0;
        width: auto;
        transform: scale(1.2);
    }
    .seki-host-mode-title {
        font-weight: 700;
        color: #9ce8ff;
    }
    .seki-host-mode-title.hot {
        color: #ffb86b;
    }
    .seki-host-mode-meta {
        font-size: 12px;
        color: #9cb3c9;
        margin-left: 5px;
    }
    .seki-host-actions {
        display: flex;
        gap: 10px;
    }
    .seki-host-actions .modal-btn {
        margin: 0;
    }
    .seki-host-actions .modal-btn.primary {
        flex: 1;
    }
    .seki-host-actions .modal-btn.danger {
        width: 80px;
    }
    .seki-guide-root {
        text-align: left;
    }
    .seki-guide-role-group {
        margin-bottom: 14px;
        padding: 8px 8px 2px;
        border: 1px solid rgba(var(--role-accent-rgb, 0, 216, 255), 0.28);
        border-radius: 10px;
        background: linear-gradient(160deg, rgba(6, 16, 32, 0.62), rgba(4, 11, 23, 0.5));
    }
    .seki-guide-group-title {
        margin: 0 0 8px 0;
        font-size: 12px;
        letter-spacing: 0.12em;
        color: var(--role-accent, #9ce8ff);
        text-shadow: 0 0 8px rgba(var(--role-accent-rgb, 0, 216, 255), 0.24);
    }
    .seki-guide-role-item {
        margin-bottom: 10px;
        border-bottom: 1px solid rgba(var(--role-accent-rgb, 143, 176, 214), 0.28);
        padding-bottom: 5px;
    }
    .seki-guide-role-item.is-public-unused {
        opacity: 0.58;
        filter: grayscale(0.45);
    }
    .seki-guide-summary {
        cursor: pointer;
        display: flex;
        align-items: center;
        outline: none;
        list-style: none;
    }
    .seki-guide-role-img {
        height: 40px;
        vertical-align: middle;
        margin-right: 10px;
        border-radius: 4px;
        border: 1px solid rgba(143, 176, 214, 0.45);
    }
    .seki-guide-role-main {
        flex: 1;
    }
    .seki-guide-role-jp {
        font-weight: 700;
        color: var(--role-accent, #9ce8ff);
        font-size: 15px;
    }
    .seki-guide-role-en {
        font-size: 13px;
        color: #cce6ff;
        font-weight: 400;
        margin-left: 4px;
    }
    .seki-guide-role-summary {
        font-size: 12px;
        color: #d9ebff;
        display: flex;
        justify-content: space-between;
        align-items: baseline;
    }
    .seki-guide-role-detail {
        margin-top: 10px;
        padding: 10px;
        background: rgba(6, 16, 32, 0.52);
        border-radius: 5px;
        font-size: 12px;
        color: #d9ebff;
        line-height: 1.6;
        border: 1px solid rgba(143, 176, 214, 0.28);
    }
    .seki-guide-hint {
        font-size: 12px;
        color: #9cb3c9;
        white-space: nowrap;
    }
    .seki-guide-public-tag {
        margin-left: 6px;
        font-size: 12px;
        color: #cfd7de;
        background: rgba(93, 104, 114, 0.5);
        border: 1px solid rgba(180, 190, 198, 0.6);
        border-radius: 10px;
        padding: 1px 6px;
    }
    .seki-rule-root {
        text-align: left;
        font-size: 13px;
        color: #d9ebff;
    }
    .seki-rule-paragraph {
        margin: 0 0 10px 0;
    }
    .seki-rule-heading {
        border-left: 4px solid #0fa0d8;
        padding-left: 8px;
        margin: 10px 0 5px 0;
        color: #b7ecff;
    }
    .seki-rule-heading.danger {
        border-left-color: #c62828;
    }
    .seki-rule-heading.info {
        border-left-color: #1565c0;
    }
    .seki-rule-heading.warn {
        border-left-color: #f76205;
    }
    .seki-rule-list {
        padding-left: 20px;
        margin: 0;
    }
    .score-dist {
        font-size: 12px;
        color: #d9ebff;
        margin-bottom: 10px;
        background: rgba(188, 140, 20, 0.2);
        padding: 5px;
        border-radius: 4px;
        text-align: center;
        border: 1px solid rgba(251, 192, 45, 0.55);
    }
    .score-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }
    .score-head {
        border-bottom: 2px solid rgba(143, 176, 214, 0.45);
        background: rgba(8, 26, 48, 0.55);
    }
    .score-table th,
    .score-table td {
        padding: 8px;
    }
    .score-table th:first-child,
    .score-name-cell {
        text-align: center;
    }
    .score-table th:last-child,
    .score-point-cell {
        text-align: right;
    }
    .score-empty {
        padding: 20px;
        color: #9cb3c9;
        text-align: center;
    }
    .score-row {
        border-bottom: 1px solid rgba(143, 176, 214, 0.28);
    }
    .score-row.me {
        color: #ffadb8;
        font-weight: 700;
    }
    .score-point-cell {
        font-weight: 700;
    }
    .score-reset-wrap {
        margin-top: 20px;
        text-align: center;
    }
    .score-reset-btn {
        font-size: 12px;
        color: #9cb3c9;
        background: rgba(6, 16, 32, 0.6);
        border: 1px solid rgba(143, 176, 214, 0.4);
        border-radius: 4px;
        padding: 4px 8px;
        cursor: pointer;
        transition: border-color var(--seki-transition-fast), color var(--seki-transition-fast), background var(--seki-transition-fast);
    }
    .score-reset-btn:hover {
        border-color: rgba(0, 216, 255, 0.65);
        color: #d9ebff;
        background: rgba(8, 26, 48, 0.7);
    }

    /* ログスタイル */
    .log-entry { text-align: left; padding: 8px; border-bottom: 1px solid rgba(143, 176, 214, 0.28); font-size: 13px; display: flex; align-items: flex-start; }
    .log-time { color: #a1b4cc; margin-right: 10px; font-size: 12px; min-width: 45px; }
    .log-text { word-break: break-all; line-height: 1.4; }
    .log-private .log-text { color: #ffc8d3; font-weight: bold; background: rgba(136, 20, 45, 0.34); padding: 2px 5px; border-radius: 4px;}
    .log-chat { background: rgba(0, 216, 255, 0.08); }
    
    /* チャット入力 */
    #chat-input-container { display: flex; gap: 8px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(143, 176, 214, 0.3); }
    #chat-input {
        color: var(--seki-text-main);
        flex: 1;
        padding: 10px;
        border-radius: 20px;
        border: 1px solid rgba(126, 173, 224, 0.45);
        outline:none;
        background: rgba(6, 16, 32, 0.78);
        font-family: var(--font-ui);
    }
    #chat-input::placeholder {
        font-family: var(--font-ui);
    }
    #chat-send-btn { background: linear-gradient(135deg, #157a53, #34b583); color: white; border-radius: 20px; padding: 0 20px; border: 1px solid rgba(93, 255, 192, 0.45); font-family: var(--font-ui); }

    .host-settings { margin-bottom: 15px; font-size: 14px; text-align: left; background: rgba(6, 16, 32, 0.55); padding: 10px; border-radius: 8px; border: 1px solid rgba(0, 216, 255, 0.24); }
    .host-settings label { margin-right: 15px; cursor: pointer; display: inline-block; padding: 5px; }
/* --- 追加修正: 墓地カードのはみ出し防止 --- */
    
    /* 墓地（pile）の中にあるカードは余白と影をなくす */
    .pile .card {
        margin: 0; 
        box-shadow: none; /* 埋まっている感じにするため影も消す */
        width: 100%; /* 枠いっぱいに広げる */
        height: 100%;
        border: none; /* 枠線もpile側に任せて消す */
        border-radius: 6px; /* 角丸を合わせる */
    }
    
    /* 墓地のカードはホバーしても浮き上がらないようにする */
    .pile:hover .card {
        transform: none; 
    }

    /* --- 役職パネルのデザイン --- */
    #my-role-panel {
        margin: 10px 0;
        display: flex;
        justify-content: center;
    }

    .role-card {
        background:
            linear-gradient(
                135deg,
                rgba(var(--role-accent-rgb, 0, 216, 255), 0.24),
                rgba(4, 11, 23, 0.9) 65%
            );
        color: var(--seki-text-main);
        padding: 10px 20px;
        border-radius: var(--seki-radius-sm);
        border: 1px solid rgba(var(--role-accent-rgb, 0, 216, 255), 0.42);
        box-shadow: 0 4px 12px rgba(0,0,0,0.45), inset 0 0 12px rgba(var(--role-accent-rgb, 0, 216, 255), 0.12);
        text-align: center;
        width: 100%;
        max-width: 300px;
        position: relative;
        overflow: hidden;
    }
    
    /* 背景にうっすら装飾 */
    .role-card::before {
        content: 'ROLE';
        position: absolute;
        top: -10px; right: -10px;
        font-size: 50px;
        color: rgba(255,255,255,0.05);
        font-weight: bold;
        transform: rotate(15deg);
    }

    .role-name {
        font-family: var(--font-display-strong);
        font-size: 16px;
        letter-spacing: 1px;
        color: var(--role-accent, #8fefff);
        text-shadow: 0 0 8px rgba(var(--role-accent-rgb, 0, 216, 255), 0.35);
        text-transform: uppercase;
        font-weight: bold;
    }
    
    .role-jp {
        font-size: 20px;
        font-weight: bold;
        margin: 2px 0;
        text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    .role-desc {
        font-size: 11px;
        color: #d9ebff;
        border-top: 1px solid rgba(var(--role-accent-rgb, 179, 223, 255), 0.4);
        margin-top: 5px;
        padding-top: 4px;
    }
    /* --- スキルカットイン演出 --- */
    #cut-in-overlay {
        position: fixed;
        inset: 0;
        z-index: 12050;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.12s linear;
        font-family: var(--font-ui);
        --cut-in-theme: var(--seki-s);
    }
    #cut-in-overlay.active {
        opacity: 1;
    }
    #cut-in-overlay.attr-s {
        --cut-in-theme: var(--seki-s);
    }
    #cut-in-overlay.attr-e {
        --cut-in-theme: var(--seki-e);
    }
    #cut-in-overlay.attr-k {
        --cut-in-theme: var(--seki-k);
    }

    #cut-in-overlay > svg {
        position: absolute;
        width: 0;
        height: 0;
    }
    #cut-in-canvas,
    #cut-in-scanlines,
    #cut-in-metadata,
    #cut-in-fx {
        position: absolute;
        inset: 0;
    }
    #cut-in-canvas {
        z-index: 0;
    }
    #cut-in-scanlines {
        z-index: 5;
        opacity: 0.58;
        background: linear-gradient(to bottom, rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.26) 51%);
        background-size: 100% 4px;
    }
    #cut-in-metadata {
        z-index: 8;
        opacity: 0.5;
        mix-blend-mode: screen;
        font-family: var(--font-readable);
        font-size: 10px;
        color: var(--cut-in-theme);
        overflow: hidden;
    }
    .cut-in-meta-group {
        position: absolute;
        display: flex;
        flex-direction: column;
        gap: 2px;
        letter-spacing: 0.03em;
    }
    .cut-in-meta-top-left {
        top: 20px;
        left: 20px;
    }
    .cut-in-meta-top-right {
        top: 20px;
        right: 20px;
        text-align: right;
    }
    .cut-in-meta-bot-left {
        bottom: 20px;
        left: 20px;
    }
    .cut-in-meta-bot-right {
        bottom: 20px;
        right: 20px;
        text-align: right;
    }
    .cut-in-meta-log-scroll {
        top: 10%;
        left: 2%;
        width: 210px;
        height: 80%;
        overflow: hidden;
        opacity: 0.38;
        mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
    }
    .cut-in-meta-log-content {
        white-space: pre;
        line-height: 1.2;
        animation: cutInMetaScrollUp 8s linear infinite;
    }
    .cut-in-meta-log-scroll-2 {
        top: 15%;
        left: 15%;
        width: 165px;
        height: 70%;
        overflow: hidden;
        opacity: 0.2;
        font-size: 8px;
        mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
    }
    .cut-in-meta-log-content-2 {
        white-space: pre;
        line-height: 1.2;
        animation: cutInMetaScrollUp 12s linear infinite;
    }
    .cut-in-meta-hex {
        top: 5%;
        right: 2%;
        writing-mode: vertical-rl;
        opacity: 0.28;
        letter-spacing: 2px;
        font-size: 9px;
        height: 90%;
        mask-image: linear-gradient(to bottom, transparent, black, transparent);
    }
    .cut-in-meta-hex-content {
        white-space: pre;
        animation: cutInMetaScrollDown 25s linear infinite;
    }
    .cut-in-meta-system-scroll {
        top: 20%;
        right: 8%;
        width: 180px;
        height: 60%;
        overflow: hidden;
        opacity: 0.25;
        text-align: right;
        mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
    }
    .cut-in-meta-system-content {
        white-space: pre;
        line-height: 1.4;
        animation: cutInMetaScrollUp 10s linear infinite;
    }
    .cut-in-meta-stream {
        position: absolute;
        white-space: nowrap;
        opacity: 0.35;
        font-size: 11px;
        letter-spacing: 1px;
    }
    .cut-in-meta-stream-top {
        top: 5px;
        left: 0;
        animation: cutInMetaDriftRight 40s linear infinite;
    }
    .cut-in-meta-stream-bottom {
        bottom: 5px;
        left: 0;
        animation: cutInMetaDriftLeft 40s linear infinite;
    }
    .cut-in-meta-bg-code {
        position: absolute;
        top: 0;
        left: 20%;
        width: 60%;
        height: 100%;
        opacity: 0.05;
        font-size: 12px;
        overflow: hidden;
        mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
    }
    .cut-in-meta-bg-code-content {
        white-space: pre;
        animation: cutInMetaScrollUp 30s linear infinite;
    }
    @keyframes cutInMetaScrollUp {
        0% { transform: translateY(0); }
        100% { transform: translateY(-50%); }
    }
    @keyframes cutInMetaScrollDown {
        0% { transform: translateY(-50%); }
        100% { transform: translateY(0); }
    }
    @keyframes cutInMetaDriftRight {
        0% { transform: translateX(-50%); }
        100% { transform: translateX(0); }
    }
    @keyframes cutInMetaDriftLeft {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }

    #cut-in-slit {
        position: relative;
        z-index: 20;
        width: min(180vw, 1500px);
        height: clamp(220px, 35vh, 350px);
        display: flex;
        align-items: center;
        overflow: hidden;
        opacity: 0;
        transform: rotate(-4deg);
        background: rgba(5, 12, 25, 0.95);
        border-top: 2px solid var(--cut-in-theme);
        border-bottom: 2px solid var(--cut-in-theme);
        box-shadow: 0 0 60px rgba(0, 0, 0, 0.82), inset 0 0 50px var(--cut-in-theme);
        backdrop-filter: blur(10px);
    }
    #cut-in-overlay.attr-s.active #cut-in-slit {
        animation: cutInSEntrance 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards;
    }
    #cut-in-overlay.attr-e.active #cut-in-slit {
        animation: cutInEEntrance 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    #cut-in-overlay.attr-k.active #cut-in-slit {
        animation: cutInKEntrance 0.3s steps(5) forwards;
    }
    #cut-in-overlay.attr-k.active::before {
        content: "";
        position: absolute;
        inset: 0;
        z-index: 15;
        background: #000;
        animation: cutInKBlackout 0.3s forwards;
    }
    @keyframes cutInSEntrance {
        0% { opacity: 0; transform: rotate(-4deg) scaleY(0.1); filter: blur(10px); }
        100% { opacity: 1; transform: rotate(-4deg) scaleY(1); filter: blur(0); }
    }
    @keyframes cutInEEntrance {
        0% { opacity: 0; transform: rotate(-4deg) translateX(150%) skewX(-30deg); }
        70% { transform: rotate(-4deg) translateX(-5%) skewX(5deg); }
        100% { opacity: 1; transform: rotate(-4deg) translateX(0) skewX(0); }
    }
    @keyframes cutInKEntrance {
        0% { opacity: 0; transform: rotate(0deg) scale(1.5); }
        50% { opacity: 0.5; transform: rotate(-6deg) scale(0.9); filter: invert(1); }
        100% { opacity: 1; transform: rotate(-4deg) scale(1); filter: none; }
    }
    @keyframes cutInKBlackout {
        0% { opacity: 0; }
        10% { opacity: 1; }
        80% { opacity: 1; }
        100% { opacity: 0; }
    }

    #cut-in-overlay.impact-pulse {
        animation: cutInShake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
    }
    #cut-in-overlay.impact-pulse #cut-in-slit {
        filter: url(#cut-in-rgb-shift) brightness(1.35);
    }
    @keyframes cutInShake {
        0% { transform: translate(0, 0); }
        10% { transform: translate(-5px, -2px); }
        20% { transform: translate(5px, 2px); }
        30% { transform: translate(-7px, 0); }
        40% { transform: translate(7px, 0); }
        100% { transform: translate(0, 0); }
    }

    #cut-in-role-image-wrap {
        position: absolute;
        left: 8%;
        bottom: -15%;
        height: 150%;
        z-index: 10;
        transform: rotate(4deg);
        filter: drop-shadow(0 0 30px var(--cut-in-theme));
        opacity: 1;
        transition: opacity 0.2s ease;
    }
    #cut-in-role-image-wrap.is-hidden {
        opacity: 0;
    }
    #cut-in-role-img {
        width: auto;
        height: 100%;
        object-fit: contain;
    }
    #cut-in-info {
        position: relative;
        z-index: 20;
        margin-left: 45%;
        width: 50%;
        transform: rotate(4deg);
        display: flex;
        flex-direction: column;
        gap: 6px;
    }
    #cut-in-tags {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
        margin-bottom: 10px;
    }
    #cut-in-role-name {
        background: var(--cut-in-theme);
        color: #000;
        padding: 5px 30px;
        font-family: var(--font-display-strong);
        font-size: clamp(24px, 5vw, 40px);
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 2px;
        clip-path: polygon(0% 0%, 95% 0%, 100% 100%, 0% 100%);
        box-shadow: 0 0 30px var(--cut-in-theme);
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
    }
    #cut-in-player-name {
        padding-left: 5px;
        font-size: clamp(14px, 3vw, 20px);
        font-family: var(--font-readable);
        font-weight: bold;
        letter-spacing: 0.06em;
        opacity: 0.9;
        color: #eff6ff;
        text-shadow: 0 0 5px var(--cut-in-theme);
    }
    #cut-in-skill-names {
        text-align: left;
    }
    #cut-in-skill-eng {
        margin: 0;
        line-height: 0.9;
        white-space: nowrap;
        font-family: var(--font-display-strong);
        font-size: clamp(40px, 8vw, 70px);
        font-weight: 900;
        letter-spacing: 2px;
        color: #ffffff;
        text-shadow: 0 0 30px var(--cut-in-theme);
    }
    #cut-in-skill-jp {
        margin: 5px 0 0 5px;
        white-space: nowrap;
        font-family: var(--font-readable);
        font-size: clamp(18px, 4vw, 30px);
        font-weight: 700;
        letter-spacing: 0.12em;
        color: var(--cut-in-theme);
        text-shadow: 0 0 14px rgba(255, 255, 255, 0.15);
    }

    #cut-in-fx {
        z-index: 12;
        opacity: 0;
        transition: opacity 0.3s;
    }
    #cut-in-overlay.active #cut-in-fx {
        opacity: 1;
    }
    #cut-in-overlay.attr-s #cut-in-fx {
        background: radial-gradient(circle at center, rgba(0, 234, 255, 0.1) 0%, transparent 70%);
    }
    #cut-in-overlay.attr-s #cut-in-fx::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 150vh;
        height: 150vh;
        border: 2px dashed rgba(0, 234, 255, 0.3);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        background:
            radial-gradient(transparent 60%, rgba(0, 234, 255, 0.2) 61%, transparent 62%),
            radial-gradient(transparent 40%, rgba(0, 234, 255, 0.2) 41%, transparent 42%);
        animation: cutInSOrbitSpin 20s linear infinite;
    }
    #cut-in-overlay.attr-s #cut-in-fx::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100vh;
        height: 100vh;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        mix-blend-mode: overlay;
        background: conic-gradient(from 0deg, transparent 0deg, rgba(0, 234, 255, 0.5) 20deg, transparent 40deg);
        animation: cutInSScanSpin 4s linear infinite;
    }
    @keyframes cutInSOrbitSpin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
    @keyframes cutInSScanSpin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    #cut-in-overlay.attr-e #cut-in-fx {
        mix-blend-mode: screen;
        background: radial-gradient(circle at center, rgba(0, 255, 106, 0.05) 0%, transparent 80%);
    }
    #cut-in-overlay.attr-e #cut-in-fx::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 200%;
        height: 100%;
        background: linear-gradient(90deg, transparent 0%, rgba(0, 255, 106, 0.1) 20%, rgba(0, 255, 106, 0.3) 25%, rgba(0, 255, 106, 0.1) 30%, transparent 50%);
        background-size: 50% 100%;
        animation: cutInELiquidFlow 3s linear infinite;
    }
    #cut-in-overlay.attr-e #cut-in-fx::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        filter: blur(2px);
        background: repeating-linear-gradient(0deg, transparent, transparent 48%, rgba(0, 255, 106, 0.1) 50%, transparent 52%);
        background-size: 100% 200%;
        animation: cutInEPulse 4s ease-in-out infinite;
    }
    @keyframes cutInELiquidFlow {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }
    @keyframes cutInEPulse {
        0% { background-position: 0 0; opacity: 0.3; }
        50% { opacity: 0.6; }
        100% { background-position: 0 100%; opacity: 0.3; }
    }

    #cut-in-overlay.attr-k #cut-in-fx {
        opacity: 0.8;
        mix-blend-mode: screen;
        background: conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(255, 0, 0, 0.6) 30deg, transparent 60deg, transparent 180deg, rgba(255, 0, 0, 0.6) 210deg, transparent 240deg);
        animation: cutInKSiren 1s linear infinite;
    }
    #cut-in-overlay.attr-k #cut-in-fx::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: repeating-linear-gradient(transparent, transparent 2px, rgba(0, 0, 0, 0.5) 3px, transparent 4px);
        animation: cutInKNoise 0.2s steps(10) infinite;
    }
    #cut-in-overlay.attr-k.active::after {
        content: "";
        position: absolute;
        inset: 0;
        z-index: 50;
        pointer-events: none;
        box-shadow: inset 0 0 100px rgba(255, 0, 0, 0.8);
        animation: cutInKFlash 0.1s infinite alternate;
    }
    @keyframes cutInKSiren {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    @keyframes cutInKNoise {
        0% { transform: translate(0, 0); }
        100% { transform: translate(10px, 10px); }
    }
    @keyframes cutInKFlash {
        0% { opacity: 0.3; }
        100% { opacity: 0.7; }
    }

    @media (max-width: 768px) {
        #cut-in-slit {
            width: 200%;
            height: 350px;
        }
        #cut-in-role-image-wrap {
            left: -10%;
            bottom: 0;
            height: 110%;
            opacity: 0.3;
        }
        #cut-in-info {
            margin-left: 10%;
            width: 85%;
        }
        #cut-in-role-name {
            font-size: 28px;
            padding: 5px 20px;
        }
    }

    #visual-overlay {
        font-family: var(--font-ui);
    }
    

    /* ▼▼▼ 追加：皇帝パネル用の輝きアニメーション ▼▼▼ */
    @keyframes goldShine {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    @keyframes goldPulse {
        0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
        100% { box-shadow: 0 0 30px rgba(255, 215, 0, 1.0), 0 0 10px #fff; }
    }
    
    /* --- Hacked Corner (旧スタイルは削除または無視) --- */
    /* 代わりに以下を追加 */

    /* ロックされたカードのデザイン */
    .card.locked {
        /* 通常カードと同じサイズ・配置 */
        filter: grayscale(0.9) brightness(0.6); /* モノクロにして暗くする */
        border: 2px dashed #ff1744 !important;   /* 赤枠で危険を示す */
        cursor: not-allowed;
        position: relative;
    }

    /* 右下に鍵アイコンを表示（カードの絵柄を隠さない）⇐削除済み

    /* ホバーしても浮き上がらせない */
    .card.locked:hover {
        transform: none !important;
        box-shadow: none !important;
    }

    /* 警察による公開カードのデザイン */
    .card.revealed {
        /* 青色の枠線で「警察」感を出す */
        border: 3px solid #fdd835 !important;
        box-shadow: 0 0 10px rgba(246, 246, 41, 0.6); 
        position: relative; /* 帯の配置用 */
        overflow: hidden;   /* 帯がはみ出さないように */
    }

    /* 右上の「OPEN」帯 */
    .card.revealed::after {
        content: "OPEN";
        position: absolute;
        top: 5px;
        right: -22px;
        width: 80px;
        height: 18px;
        background: #fdd835; /* 警告色（黄色） */
        color: #000;
        font-size: 10px;
        font-weight: bold;
        text-align: center;
        line-height: 18px;
        transform: rotate(45deg); /* 斜めに配置 */
        box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        z-index: 20;
        pointer-events: none; /* クリックの邪魔をしない */
        font-family: var(--font-display-strong);
    }

    /* --- スマホ・細い画面用のスリムレイアウト --- */
    @media (max-width: 600px) {
        /* 1. 左右のカラム幅を詰める */
        .player-zone.col {
            width: 105px !important; /* ボックス幅に合わせて最小限に */
            z-index: 20;
        }

        /* 2. ボックスをスリム化 */
        .player-zone.col .p-box-new {
            width: 100px !important; /* 140px -> 100px に細くする */
            height: auto !important;    /* 固定をやめて自動に */
            min-height: 180px;          /* 最低でもこの高さを確保 */
            padding-bottom: 5px;        /* 下端の余白 */ 
        }

        /* 3. 中段（手札数とステータス）を縦積みに */
        .player-zone.col .p-box-new .p-body {
            flex-direction: column; /* 縦並び */
            justify-content: center;
            gap: 8px; /* 詰める */
            padding: 5px 0;
            flex: 1;         /* 余ったスペースを埋める */
        }
        
        /* ステータス表示の位置調整 */
        .player-zone.col .p-box-new .p-status-area {
            align-items: center; /* 中央揃え */
            width: 100%;
        }

        /* 4. 下段（役職）のエリア高さを自動調整 */
        .player-zone.col .p-box-new .p-role-row {
            height: auto !important; /* 固定高さを解除 */
            min-height: 40px;        /* 最低限の高さ確保 */
            padding: 5px 0;
            display: flex;
            align-items: center;     /* 上下中央寄せ */
            justify-content: center;
            margin-top: auto; /* 一番下に押し下げる */
        }

        /* 役職バッジの中身を折り返し（縦積み）にする */
        .player-zone.col .p-box-new .role-badge-pill {
            flex-direction: column; /* 縦並び */
            width: 96%;             /* 幅いっぱい */
            padding: 4px 0;
            line-height: 1.2;
            border-radius: 8px;     /* 角丸を少し緩める */
        }
        
        /* 役職の補足（REVERSEなど）のデザイン調整 */
        .player-zone.col .p-box-new {
            display: block;        /* 改行させる */
            margin-left: 0;
            margin-top: 3px;
            font-size: 9px;        /* 少し小さく */
            opacity: 0.9;
        }
        .role-sub {
            display: block;        /* 改行させる */
            margin-left: 0;
            margin-top: 3px;
            font-size: 13px;        /* 少し小さく */
            opacity: 1;
        }

        /* 公開カード置き場も幅を合わせる */
        .player-zone.col .p-revealed-container {
            width: 100px !important;
        }
        
        /* 中央フィールドとの隙間を詰める */
        #field-center {
            margin: 0 !important;
        }
        #area-middle {
            gap: 2px !important; /* 左右ボックスとの隙間を最小限に */
        }

    }

    /* --- 追加: 公開カード情報（テキスト表示用） --- */
        .p-revealed-info {
            font-size: 11px;
            margin-top: 5px;     /* ステータスとの隙間 */
            white-space: nowrap; /* 折り返しなし */
            line-height: 1.2;
            /* ★ここが重要: ゲーム全体のフォントトークンを強制する */
            font-family: var(--font-ui) !important;
        }

        /* 何も公開されていない時 (NORMAL表示と同じような色に) */
        .revealed-none {
            color: #9cb3c9;
            font-weight: bold;
        }

        /* 公開されている時 (目立たせる) */
        .revealed-active {
            color: #ffeb3b;      /* 黄色 */
            font-weight: bold;
        }
        
        /* 元々の画像表示エリアは完全に非表示にする */
        .p-revealed-container {
            display: none !important;
        }
        
        /* スマホ表示の微調整 */
        @media (max-width: 600px) {
            .p-revealed-info {
                font-size: 10px;
            }
        }

        /* --- 点滅アニメーション定義 --- */
        @keyframes blink-text {
            0% { opacity: 1.0; transform: scale(1.0); }
            50% { opacity: 0.5; transform: scale(1.05); } /* 半透明になりつつ少し大きくなる */
            100% { opacity: 1.0; transform: scale(1.0); }
        }
        /* --- チャット吹き出し (Chat Bubble) --- */
    .chat-bubble {
        position: absolute;
        background: #fff;
        color: #000;
        font-size: 11px;
        font-weight: bold;
        padding: 6px 10px;
        border-radius: 12px;
        max-width: 240px;       /* 長文は省略 */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        opacity: 0;             /* 最初は隠す */
        pointer-events: none;   /* クリックの邪魔をしない */
        z-index: 500;           /* カードより手前 */
        transition: opacity 0.2s;
    }

    /* 吹き出しのしっぽ (共通) */
    .chat-bubble::after {
        content: "";
        position: absolute;
        border-style: solid;
        display: block;
    }

    /* アニメーションクラス */
    .chat-bubble.active {
        animation: bubble-pop 4s ease-out forwards;
    }

    @keyframes bubble-pop {
        0% { opacity: 0; transform: scale(0.5); }
        10% { opacity: 1; transform: scale(1); }
        85% { opacity: 1; transform: scale(1); }
        100% { opacity: 0; transform: scale(0.8); }
    }

    /* --- 位置別のスタイル (画面内側に向くように配置) --- */

    /* 1. 自分 (下部配置) -> 吹き出しは「上」に出す */
    .bubble-pos-bottom {
        bottom: 110%; /* 箱の上に */
        left: 50%;
        transform: translateX(-50%);
    }
    .bubble-pos-bottom::after {
        bottom: -6px; left: 50%; margin-left: -6px;
        border-width: 6px 6px 0;
        border-color: #fff transparent;
    }

    /* 2. 上の人 (上部配置) -> 吹き出しは「下」に出す */
    .bubble-pos-top {
        top: 100%;    /* 箱の下に */
        left: 0;
        margin-top: 10px;
        transform: none;
    }
    .bubble-pos-top::after {
        top: -6px; left: 50%; margin-left: -6px;
        border-width: 0 6px 6px;
        border-color: #fff transparent;
    }

    /* 3. 左の人 -> 吹き出しは「右」に出す */
    .bubble-pos-left {
        top: auto;
        bottom: 100%; /* ボックスの上に */
        
        /* 左端をボックスに合わせる */
        left: 0;
        right: auto;
        
        /* 隙間調整 */
        margin-bottom: 10px; 
        margin-left: 0;
        margin-right: 0;
        
        transform: none;
    }
    .bubble-pos-left::after {
        top: 50%; right: 100%; margin-top: -6px;
        border-width: 6px 6px 6px 0;
        border-color: transparent #fff;
    }

    /* 4. 右の人 -> 吹き出しは「左」に出す */
    .bubble-pos-right {
        /* 上に出す設定(bottom)を解除し、下(top: 100%)に出す */
        top: 100%;
        bottom: auto;
        
        /* 左端をボックスに合わせる */
        left: auto;
        right: 0;
        
        /* 隙間調整 (上側にマージンを入れる) */
        margin-top: 10px; 
        margin-bottom: 0;
        margin-left: 0;
        margin-right: 0;
        
        transform: none;
    }
    .bubble-pos-right::after {
        top: 50%; left: 100%; margin-top: -6px;
        border-width: 6px 0 6px 6px;
        border-color: transparent #fff;
    }

    /* スマホ調整: 左右の人が画面端すぎる場合、少し内側に寄せる微調整 */
    @media (max-width: 600px) {
        .chat-bubble { max-width: 90px; font-size: 10px; }
    }



</style>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>

    <div id="login-screen">
        <canvas id="login-cyber-bg" aria-hidden="true"></canvas>
        <div class="login-grid" aria-hidden="true"></div>
        <div class="login-scanlines" aria-hidden="true"></div>

        <div id="login-panel">
            <img src="./images/new_logo.png" alt="SEKI Online" id="title-logo">
            <p class="version-text">Ver 30.00 NEW GAME</p>
            <p class="seki-tagline">STRATEGY // EFFICIENCY // KILLER // INTERFACE; S.E.K.I.</p>
            <input type="text" id="roomName" placeholder="Room ID (e.g. seki123)">
            <div id="room-suggestion-panel" class="hidden"></div>
            <input type="text" id="playerName" placeholder="Your Name">
            <button id="btn-join" onclick="joinGame()">JOIN / CREATE ROOM</button>
        </div>
    </div>

    <div id="asset-loading-screen" class="hidden" aria-live="polite" aria-busy="true">
        <div id="asset-loading-panel">
            <h3>
                LOADING S.E.K.I. PROTOCOL...
                <span class="seki-loading-sub">[STRATEGY-EFFICIENCY-KILLER-INTERFACE]</span>
            </h3>
            <p id="asset-loading-text">0 / 0 (0%)</p>
            <div id="asset-loading-progress-track">
                <div id="asset-loading-bar"></div>
            </div>
            <p id="asset-loading-current">準備中...</p>
            <div id="asset-loading-failed" class="hidden"></div>
            <div id="asset-loading-actions" class="hidden">
                <button id="asset-loading-retry-btn" type="button">再試行</button>
                <button id="asset-loading-continue-btn" type="button">続行</button>
            </div>
        </div>
    </div>

    <div id="boot-transition-screen" class="hidden" aria-hidden="true">
        <h2 id="boot-transition-title">S.E.K.I. BOOTING</h2>
    </div>

    <script src="scripts/bootstrap/login-cyber-bg.js"></script>

    <div id="game-screen" class="hidden">
        <div id="header-info" class="seki-topbar">
            <div id="room-display"></div>
            <div class="seki-topbar-actions">
                <button id="btn-host-settings" class="hidden seki-btn seki-btn-host seki-btn-accent" onclick="openHostSettings()">
                    ⚙️
                </button>
                <button onclick="showScoreboard()" class="seki-btn seki-btn-mini seki-btn-gold">🏆</button>
                <button onclick="showRoleList()" class="seki-btn seki-btn-mini seki-btn-accent">役職</button>
                <button onclick="showRule()" class="seki-btn seki-btn-mini">ルール</button>
                <button id="btn-bgm-toggle" onclick="toggleBgmMute()" class="seki-btn seki-btn-mini">🔊</button>
                <button onclick="leaveRoom()" class="seki-btn seki-btn-mini seki-btn-danger">🚪</button>
            </div>
        </div>

        <div id="game-table">
            
            <div id="area-top" class="player-zone row"></div>

            <div id="area-middle">
                <div id="area-left" class="player-zone col"></div>

                <div id="field-center">
                    <div id="flow-indicator-row">
                        <img id="indicator" src="./images/reverse_blue.jpg" alt="順行/逆行">
                        <div id="astronomer-indicator" aria-live="polite">
                            <div id="astronomer-indicator-state">観測待機</div>
                            <div id="astronomer-indicator-value">-</div>
                        </div>
                    </div>
                    
                    <div class="field-zone-container">
                        
                        <div class="field-zone zone-num">
                            <div class="zone-label">数字墓地</div>
                            
                            <div class="grave-slot" onclick="viewGrave('num')">
                                <div id="graveNum" class="pile"></div>
                            </div>
                            
                            <div class="deck-slot">
                                <div class="deck-icon num"></div>
                                <div id="deckNumCount" class="deck-count">-</div>
                            </div>
                        </div>

                        <div class="field-zone zone-sym">
                            <div class="zone-label">記号墓地</div>
                            
                            <div class="grave-slot" onclick="viewGrave('sym')">
                                <div id="graveSym" class="pile"></div>
                            </div>
                            
                            <div class="deck-slot">
                                <div class="deck-icon sym"></div>
                                <div id="deckSymCount" class="deck-count">-</div>
                            </div>
                        </div>
                    </div>

                    <div id="exclusion-area" onclick="viewGrave('excl')">
                        <span>🗑️除外：</span>
                        <span id="exclusion-count">0</span>
                    </div>
                    
                    <div id="msg" class="seki-msg">待機中...</div>

                    <div id="role-draft-monitor" class="hidden" aria-live="polite"></div>
                </div>

                <div id="area-right" class="player-zone col"></div>
            </div>

            <div id="my-area">
                <div id="my-name-bar" class="my-name-plate"></div>
            
                <div id="my-hand"></div>
                <div id="controls" class="seki-controls">
                    <button id="btn-play" onclick="playCard()" class="seki-btn seki-btn-accent">PLAY</button>
                    <button id="btn-pass" onclick="passTurn()" class="seki-btn seki-btn-soft">PASS</button>
                </div>

                <div id="my-role-panel"></div>

            </div>
        </div>
    </div>

    <div id="game-log-bar" onclick="showLogHistory()">ログを読み込み中...</div>

    <div id="modal-overlay" class="hidden">
        <div id="modal-box">
            <h3 id="modal-title">タイトル</h3>
            <div id="modal-content">内容</div>
            <div id="modal-footer">
                <button onclick="closeModal()" class="modal-btn ghost">CLOSE</button>
            </div>
        </div>
    </div>

    <div id="cut-in-overlay" class="hidden" aria-hidden="true">
        <svg aria-hidden="true" focusable="false">
            <defs>
                <filter id="cut-in-rgb-shift" x="-20%" y="-20%" width="140%" height="140%">
                    <feOffset in="SourceGraphic" dx="-5" dy="0" result="offR"></feOffset>
                    <feOffset in="SourceGraphic" dx="0" dy="0" result="offG"></feOffset>
                    <feOffset in="SourceGraphic" dx="5" dy="0" result="offB"></feOffset>
                    <feColorMatrix in="offR" type="matrix" values="1 0 0 0 0  0 0 0 0 0  0 0 0 0 0  0 0 0 1 0" result="chanR"></feColorMatrix>
                    <feColorMatrix in="offG" type="matrix" values="0 0 0 0 0  0 1 0 0 0  0 0 0 0 0  0 0 0 1 0" result="chanG"></feColorMatrix>
                    <feColorMatrix in="offB" type="matrix" values="0 0 0 0 0  0 0 0 0 0  0 0 1 0 0  0 0 0 1 0" result="chanB"></feColorMatrix>
                    <feMerge>
                        <feMergeNode in="chanR"></feMergeNode>
                        <feMergeNode in="chanG"></feMergeNode>
                        <feMergeNode in="chanB"></feMergeNode>
                    </feMerge>
                </filter>
            </defs>
        </svg>
        <canvas id="cut-in-canvas" aria-hidden="true"></canvas>
        <div id="cut-in-scanlines" aria-hidden="true"></div>
        <div id="cut-in-metadata" aria-hidden="true">
            <div class="cut-in-meta-group cut-in-meta-top-left">
                <span>SYS_ID: 44X-99 ALPHA</span>
                <span>MEM: 2048TB [OK]</span>
                <span>SYNC: 99.9%</span>
                <span>PROT: ENCRYPTED_V4</span>
            </div>
            <div class="cut-in-meta-group cut-in-meta-top-right">
                <span>UPTIME: 4492:12:44</span>
                <span>CONN: SECURE</span>
                <span>MODE: BURST</span>
            </div>
            <div class="cut-in-meta-group cut-in-meta-bot-left">
                <span>SEC_SECTOR: 7G</span>
                <span>TRACE: NULL</span>
            </div>
            <div class="cut-in-meta-group cut-in-meta-bot-right">
                <span>LAT: 35.6895 LON: 139.6917</span>
                <span>PACKET_LOSS: 0.00%</span>
                <span>THREAT_LVL: MONITORING</span>
                <span>S.E.K.I. OS VER 2.0</span>
            </div>

            <div class="cut-in-meta-group cut-in-meta-log-scroll">
                <div class="cut-in-meta-log-content">> INITIATING HANDSHAKE...
> CONNECTING TO SERVER...
> AUTHENTICATING USER...
> LOADING ASSETS...
> [SUCCESS] STREAM OPEN
> BUFFERING DATA... 12%
> BUFFERING DATA... 45%
> BUFFERING DATA... 89%
> [WARNING] HIGH LATENCY
> OPTIMIZING ROUTE...
> ROUTE FOUND: NODE_04
> DECRYPTING KEY...
> ACCESS GRANTED.
> SYSTEM READY.
> EXECUTING SCRIPT...
> CHECKING INTEGRITY...
> THREAT DETECTED: NONE
> ALL SYSTEMS GO.
> WAITING FOR INPUT...</div>
            </div>
            <div class="cut-in-meta-group cut-in-meta-log-scroll-2">
                <div class="cut-in-meta-log-content-2">[INFO] Process 4491 started
[INFO] Memory alloc: 4096KB
[WARN] Deprecated API call
[INFO] Thread 2 suspended
[INFO] Garbage collection...
[INFO] GC finished in 4ms
[INFO] New socket open: 8080
[INFO] Token verified
[INFO] Session ID: x99a-22</div>
            </div>
            <div class="cut-in-meta-group cut-in-meta-hex">
                <div class="cut-in-meta-hex-content">0F 3A 9C 4D 55 1B 00 FF
A2 4E 88 90 11 22 33 44
55 66 77 88 99 AA BB CC
DD EE FF 00 12 34 56 78
9A BC DE F0 0F 3A 9C 4D
55 1B 00 FF A2 4E 88 90</div>
            </div>
            <div class="cut-in-meta-group cut-in-meta-system-scroll">
                <div class="cut-in-meta-system-content">CPU0: 12% [ACTIVE]
CPU1: 45% [ACTIVE]
CPU2: 09% [IDLE]
CPU3: 88% [BURST]
GPU0: 99% [RENDER]
VRAM: 8GB / 12GB
TEMP: 65C (NOMINAL)
FAN: 1200 RPM
POWER: STABLE
PING: 1ms</div>
            </div>
            <div class="cut-in-meta-stream cut-in-meta-stream-top">SCANNING_NETWORK // CHECKING_PORTS // FIREWALL_ACTIVE // USER_AUTH: OK // ENCRYPTION: AES-256 // CONNECTION: STABLE //</div>
            <div class="cut-in-meta-stream cut-in-meta-stream-bottom">DOWNLOADING_RESOURCES [||||||||||||||||----] 82% COMPLETE // VERIFYING CHECKSUM // INTEGRITY: 100% // NO MALWARE DETECTED //</div>
            <div class="cut-in-meta-bg-code">
                <div class="cut-in-meta-bg-code-content">function initSystem() {
  const core = new Core();
  core.loadModules(["net", "crypto", "fs"]);
  core.startService("daemon");
  if (core.status === "ok") {
    console.log("System Ready");
  } else {
    core.reboot();
  }
  return core.id;
}
class Core {
  constructor() {
    this.id = Math.random();
    this.status = "init";
  }
  loadModules(mods) {
    this.modules = mods;
  }
}</div>
            </div>
        </div>
        <div id="cut-in-fx" aria-hidden="true"></div>
        <div id="cut-in-slit">
            <div id="cut-in-role-image-wrap">
                <img src="" id="cut-in-role-img" alt="Role visual">
            </div>
            <div id="cut-in-info">
                <div id="cut-in-tags">
                    <div id="cut-in-role-name">ROLE NAME</div>
                    <div id="cut-in-player-name">PLAYER NAME</div>
                </div>
                <div id="cut-in-skill-names">
                    <div id="cut-in-skill-eng">COMMAND</div>
                    <div id="cut-in-skill-jp">スキル名</div>
                </div>
            </div>
        </div>
    </div>

    <div id="visual-overlay" class="seki-overlay" aria-hidden="true">
        <canvas id="gambler-cyber-canvas" aria-hidden="true"></canvas>
        <div id="gambler-cyber-scanlines" aria-hidden="true"></div>
        <div id="gambler-cyber-meta" aria-hidden="true">
            <div class="gambler-meta-stream top" id="gambler-meta-stream-top">:: GAMBLER PROTOCOL :: DATA ROUTING :: CARD ENCRYPTION ::</div>
            <div class="gambler-meta-stream bottom" id="gambler-meta-stream-bottom">:: SCAN MATRIX :: RESULT CHECKSUM :: SEKI ONLINE ::</div>
            <div class="gambler-meta-corner tl">
                <span id="gambler-meta-mode">MODE // STRATEGY</span>
                <span id="gambler-meta-proto">PROTO // GAMBLER-ACT</span>
            </div>
            <div class="gambler-meta-corner tr">
                <span id="gambler-meta-seed">SEED // 0x00000000</span>
                <span id="gambler-meta-state">STATE // IDLE</span>
            </div>
            <div class="gambler-meta-corner bl">
                <span id="gambler-meta-guess">GUESS // --</span>
                <span id="gambler-meta-card">CARD // --</span>
            </div>
            <div class="gambler-meta-corner br">
                <span id="gambler-meta-ts">SYNC // --</span>
            </div>
        </div>
        <div id="gambler-cyber-fx" aria-hidden="true"></div>
        <div id="gambler-cyber-panel">
            <div id="gambler-cyber-guess">GUESS MODE</div>
            <div id="gambler-cyber-card">
                <div id="gambler-cyber-value">?</div>
                <div id="gambler-cyber-mask">
                    <div class="logo">SEKI</div>
                </div>
            </div>
            <div id="gambler-cyber-result">RESULT</div>
        </div>
    </div>

    <script src="scripts/app/core/00-runtime-assets-audio.js"></script>
    <script src="scripts/app/core/01-firebase-constants-rolemeta.js"></script>
    <script src="scripts/app/core/02-state-layout-role-draft-ui.js"></script>
    <script src="scripts/app/core/03-modal-guard-log-chat.js"></script>
    <script src="scripts/app/core/04-room-init-render.js"></script>
    <script src="scripts/app/core/05-turn-actions-core.js"></script>
    <script src="scripts/app/roles/10-angler.js"></script>
    <script src="scripts/app/roles/11-fortune-teller.js"></script>
    <script src="scripts/app/roles/12-astronomer.js"></script>
    <script src="scripts/app/roles/13-politician.js"></script>
    <script src="scripts/app/roles/14-thief.js"></script>
    <script src="scripts/app/roles/15-hunter.js"></script>
    <script src="scripts/app/roles/16-gambler.js"></script>
    <script src="scripts/app/roles/17-crown.js"></script>
    <script src="scripts/app/roles/18-millionaire.js"></script>
    <script src="scripts/app/roles/19-emperor.js"></script>
    <script src="scripts/app/roles/20-police-officer.js"></script>
    <script src="scripts/app/roles/21-hacker.js"></script>
    <script src="scripts/app/roles/22-alchemist.js"></script>
    <script src="scripts/app/roles/23-necromancer.js"></script>
    <script src="scripts/app/roles/24-agent.js"></script>
    <script src="scripts/app/effects/30-cutin-effects.js"></script>
    <script src="scripts/app/ui/31-effect-listener-guides-score.js"></script>
    <script src="scripts/app/public/99-window-exports.js"></script>
    <div id="counter-hud-wrapper" class="hidden">
    <div id="counter-toggle-btn" onclick="toggleCounterHUD()">
        📊
    </div>

    <div id="counter-panel">
        <div class="hud-header">
            <span>CARD COUNTER</span>
            <span class="close-btn" onclick="toggleCounterHUD()">×</span>
        </div>
        
        <div class="hud-section-title">NUMBER (残/全4)</div>
        <div class="hud-grid" id="hud-grid-num">
            <div class="hud-loading">Loading...</div>
        </div>

        <div class="hud-section-title">SYMBOL</div>
        <div class="hud-grid-sym" id="hud-grid-sym">
            <div class="hud-loading">Loading...</div>
        </div>

        <div class="hud-section-title">ROLE CANDIDATES</div>
        <div class="hud-grid-role" id="hud-grid-role">
            <div class="hud-loading">No Data</div>
        </div>
        
        <div class="hud-footnote">
            ※山札 + 相手の手札にある数 ＆ 可能性がある役職を表示
        </div>
    </div>
</div>

<style>
    /* --- カウンティングHUDのスタイル --- */
    #counter-hud-wrapper {
        font-family: var(--font-ui);
        user-select: none;
        z-index: 9999; /* 最前面に */
        /* 画面が広いときもゲームテーブル右端に沿う */
        --counter-right-anchor: max(12px, calc((100vw - 860px) / 2 + 12px));
    }

    /* 1. 開閉ボタン（スマホで邪魔にならないサイズ） */
    #counter-toggle-btn {
        position: fixed;
        top: 60px;       /* ヘッダーの下あたり */
        right: var(--counter-right-anchor);
        z-index: 2000;   
        
        width: 44px; height: 44px;
        background: rgba(4, 11, 23, 0.8);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 216, 255, 0.62);
        border-radius: 50%;
        
        display: flex; justify-content: center; align-items: center;
        color: #dff6ff;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5), 0 0 12px rgba(0, 216, 255, 0.2);
        transition: transform 0.2s, background 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    #counter-toggle-btn:hover {
        border-color: rgba(0, 216, 255, 0.82);
        box-shadow: 0 6px 14px rgba(0,0,0,0.55), 0 0 16px rgba(0, 216, 255, 0.3);
    }
    #counter-toggle-btn:active { transform: scale(0.9); background: rgba(2, 8, 16, 0.92); }

    /* 2. パネル本体（グラスモーフィズム） */
    #counter-panel {
        position: fixed;
        top: 115px;
        right: var(--counter-right-anchor);
        z-index: 1999;
        
        width: 240px;    /* スマホでも見やすい幅 */
        background: linear-gradient(155deg, rgba(6, 16, 32, 0.9), rgba(4, 11, 23, 0.86));
        backdrop-filter: blur(15px);
        border: 1px solid rgba(0, 216, 255, 0.34);
        border-radius: 12px;
        padding: 12px;
        
        /* アニメーション（右上から展開） */
        transform-origin: top right;
        transform: scale(0);
        opacity: 0;
        transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        pointer-events: none;
        
        box-shadow: 0 10px 30px rgba(0,0,0,0.8), 0 0 22px rgba(0, 216, 255, 0.18);
    }
    /* 開いた状態 */
    #counter-panel.active {
        transform: scale(1);
        opacity: 1;
        pointer-events: auto;
    }

    /* 内部レイアウト */
    .hud-header {
        display: flex; justify-content: space-between; align-items: center;
        font-size: 12px; font-weight: bold; color: #a8e9ff;
        letter-spacing: var(--font-ui-emphasis-tracking);
        text-shadow: var(--font-ui-emphasis-shadow);
        border-bottom: 1px solid rgba(0, 216, 255, 0.28);
        padding-bottom: 5px; margin-bottom: 8px;
    }
    .close-btn { cursor: pointer; padding: 0 5px; font-size: 16px; color: #fff; }

    .hud-section-title {
        font-size: 10px; color: #b9cde4; margin-bottom: 4px; letter-spacing: 1px;
    }

    .hud-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr); /* 5列 (0-4, 5-9) */
        gap: 4px;
        margin-bottom: 12px;
    }
    .hud-grid-sym {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* 記号は2列 */
        gap: 4px;
        margin-bottom: 12px;
    }
    .hud-grid-role {
        display: grid;
        grid-template-columns: 1fr;
        gap: 4px;
        margin-top: 4px;
        margin-bottom: 4px;
    }
    .hud-role-pill {
        border-radius: 8px;
        border: 1px solid rgba(163, 196, 231, 0.3);
        padding: 4px 6px;
        text-align: center;
        font-size: 11px;
        color: #f4fbff;
        letter-spacing: 0.04em;
        text-shadow: 0 0 6px rgba(0, 0, 0, 0.45);
    }
    .hud-role-pill.role-attr-strategy {
        background: linear-gradient(135deg, rgba(0, 216, 255, 0.46), rgba(1, 16, 25, 0.86));
        border-color: rgba(0, 216, 255, 0.72);
    }
    .hud-role-pill.role-attr-efficiency {
        background: linear-gradient(135deg, rgba(52, 247, 141, 0.4), rgba(5, 20, 12, 0.86));
        border-color: rgba(52, 247, 141, 0.72);
    }
    .hud-role-pill.role-attr-killer {
        background: linear-gradient(135deg, rgba(255, 53, 94, 0.42), rgba(23, 4, 11, 0.86));
        border-color: rgba(255, 53, 94, 0.72);
    }

    .hud-item {
        background: rgba(255,255,255,0.05);
        border-radius: 6px;
        padding: 4px 0;
        text-align: center;
        border: 1px solid rgba(163, 196, 231, 0.16);
    }
    /* 残り0枚になったら暗くする */
    .hud-item.zero { opacity: 0.3; background: transparent; border: 1px dashed #444; }
    /* 残り枚数が多いときは強調 */
    .hud-item.rich { border-color: rgba(0, 216, 255, 0.36); background: rgba(0, 216, 255, 0.08); }

    .hud-val {
        font-size: 11px;
        font-weight: bold;
        color: #ccc;
        display: block;
        line-height: 1;
        margin-bottom: 2px;
        letter-spacing: var(--font-ui-emphasis-tracking);
        text-shadow: var(--font-ui-emphasis-shadow);
    }
    .hud-count {
        font-size: 15px;
        font-weight: 800;
        color: #fff;
        display: block;
        line-height: 1;
        letter-spacing: var(--font-ui-emphasis-tracking);
        text-shadow: var(--font-ui-emphasis-shadow);
    }
    .hud-loading {
        grid-column: 1/-1;
        text-align: center;
        color: #8ca2bd;
        font-size: 10px;
    }
    .hud-footnote {
        font-size: 10px;
        color: #9cb3c9;
        margin-top: 5px;
        text-align: center;
    }
    
    /* 記号ごとの色分け */
    .hud-item.sym-rev .hud-val { color: #e91e63; } /* REVERSE: 赤 */
    .hud-item.sym-tra .hud-val { color: #ff9800; } /* TRADE: オレンジ */
    .hud-item.sym-dig .hud-val { color: #795548; } /* DIG UP: 茶 */
    .hud-item.sym-dis .hud-val { color: #9e9e9e; } /* DISCARD: グレー */

</style>

<script src="scripts/features/counter-hud.js"></script>
<div id="sub-modal-overlay" class="hidden" onclick="closeSubModal()">
    <div id="sub-modal-box" onclick="event.stopPropagation()">
        <span class="close-btn" onclick="closeSubModal()">×</span>
        <h3 id="sub-modal-title">タイトル</h3>
        <div id="sub-modal-body"></div>
    </div>
</div>

<style>
    /* メインのモーダルより上に表示 */
    #sub-modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(2, 7, 15, 0.72);
        z-index: 9999;
        display: flex; justify-content: center; align-items: center;
        backdrop-filter: blur(5px);
        transition: opacity 0.2s;
    }
    #sub-modal-overlay.hidden { display: none !important; opacity: 0; }

    #sub-modal-box {
        background:
            linear-gradient(155deg, rgba(6, 16, 32, 0.9), rgba(4, 11, 23, 0.84)),
            radial-gradient(circle at 14% 16%, rgba(0, 216, 255, 0.11), transparent 36%);
        color: var(--seki-text-main);
        width: 90%; max-width: 600px;
        max-height: 80vh;
        border-radius: 14px;
        padding: 20px;
        position: relative;
        font-family: var(--font-readable);
        box-shadow: var(--seki-shadow-panel), 0 0 24px rgba(0, 216, 255, 0.18);
        border: 1px solid rgba(0, 216, 255, 0.36);
        display: flex; flex-direction: column;
        animation: subPopIn 0.2s ease-out;
    }
    @keyframes subPopIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    #sub-modal-title {
        margin: 0 0 10px 0;
        border-bottom: 2px solid rgba(0, 200, 255, 0.58);
        padding-bottom: 5px;
        color: #9ce8ff;
        font-family: var(--font-ui);
        font-size: 22px;
        font-weight: 700;
        letter-spacing: 0.05em;
    }
    #sub-modal-body { overflow-y: auto; flex: 1; text-align: left; font-size: 14px; line-height: 1.6; }

    #sub-modal-box .close-btn {
        position: absolute; top: 10px; right: 15px;
        font-size: 24px; cursor: pointer; color: #a8c7e4;
    }

    /* メインモーダルに追加する共通ボタン */
    #modal-board-toggle {
        position: absolute; top: 10px; right: 10px;
        border: 1px solid rgba(122, 168, 218, 0.6);
        border-radius: 16px;
        background: rgba(7, 22, 42, 0.92);
        color: #e6f6ff;
        padding: 3px 10px; font-size: 12px; cursor: pointer;
        line-height: 1.2; z-index: 100;
        transition: transform var(--seki-transition-fast), border-color var(--seki-transition-fast), box-shadow var(--seki-transition-fast);
    }
    #modal-board-toggle:hover {
        border-color: rgba(0, 216, 255, 0.78);
        box-shadow: 0 0 10px rgba(0, 216, 255, 0.28);
        transform: translateY(-1px);
    }
    #modal-board-toggle.active {
        background: linear-gradient(135deg, #0f314d, #166d98 46%, #00d8ff);
        border-color: rgba(0, 216, 255, 0.88);
        color: #fff;
    }

    #modal-help-btns {
        position: absolute; top: 10px; left: 10px;
        display: flex; gap: 5px; z-index: 100;
    }
    .help-icon-btn {
        background: none;
        border: 1px solid rgba(122, 168, 218, 0.6);
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        padding: 2px 6px;
        color: #e6f6ff;
        background: rgba(7, 22, 42, 0.92);
        transition: transform var(--seki-transition-fast), border-color var(--seki-transition-fast), box-shadow var(--seki-transition-fast);
    }
    .help-icon-btn:hover {
        transform: scale(1.06);
        border-color: rgba(0, 216, 255, 0.8);
        box-shadow: 0 2px 9px rgba(0,0,0,0.2), 0 0 10px rgba(0, 216, 255, 0.28);
    }
</style>

<script src="scripts/features/modal-tools.js"></script>

</body>
</html>

